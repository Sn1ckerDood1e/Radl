---
phase: 32-safe-areas-branding
plan: 03
type: execute
wave: 2
depends_on: ["32-01", "32-02"]
files_modified:
  - public/manifest.json
  - public/icons/icon-192.png
  - public/icons/icon-512.png
  - public/icons/icon-maskable-192.png
  - public/icons/icon-maskable-512.png
  - public/icons/apple-touch-icon.png
  - src/app/layout.tsx
autonomous: true
user_setup:
  - service: icon_generation
    why: "PWA requires properly sized icon assets"
    dashboard_config:
      - task: "Generate maskable icons with 40% safe zone"
        location: "Use maskable.app or image editor"

must_haves:
  truths:
    - "User installing PWA sees Radl icon on home screen"
    - "PWA theme color is brand teal (#0d9488)"
    - "Android shows correctly masked icon (not clipped)"
    - "iOS shows apple-touch-icon with solid background"
  artifacts:
    - path: "public/manifest.json"
      provides: "PWA manifest with separated icon purposes"
      contains: "purpose.*any"
    - path: "public/icons/icon-192.png"
      provides: "Standard 192x192 icon"
    - path: "public/icons/icon-512.png"
      provides: "Standard 512x512 icon"
    - path: "public/icons/apple-touch-icon.png"
      provides: "iOS home screen icon 180x180"
    - path: "src/app/layout.tsx"
      provides: "Apple touch icon metadata"
      contains: "apple-touch-icon"
  key_links:
    - from: "public/manifest.json"
      to: "public/icons/"
      via: "icon src paths"
      pattern: "/icons/icon-.*\\.png"
    - from: "src/app/layout.tsx"
      to: "public/icons/apple-touch-icon.png"
      via: "metadata.icons.apple"
      pattern: "apple-touch-icon"
---

<objective>
Update PWA manifest and icons for proper brand display across all platforms.

Purpose: Fix the discouraged "any maskable" combined purpose and add Apple touch icon for iOS home screen.

Output: Separated icon files, updated manifest, and proper metadata configuration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-safe-areas-branding/32-RESEARCH.md
@.planning/BRANDING.md

Key findings from research:
- Current manifest uses `purpose: "any maskable"` which is discouraged
- Icons should be split: separate "any" and "maskable" icons
- Maskable icons need 40% radius safe zone (content in center 60%)
- Apple touch icon needs solid background (no transparency)
- Current icons: icon-192x192.png, icon-512x512.png
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reorganize and rename icon files</name>
  <files>
public/icons/icon-192.png
public/icons/icon-512.png
public/icons/icon-maskable-192.png
public/icons/icon-maskable-512.png
public/icons/apple-touch-icon.png
  </files>
  <action>
Current state: Two icons exist as icon-192x192.png and icon-512x512.png

Since brand crest assets are not yet available (BRND-05 notes "when asset is available"), use the existing icons but reorganize for proper manifest structure:

1. Rename existing icons (remove x192/x512 from names for cleaner paths):
   ```bash
   cd /home/hb/radl/public/icons
   mv icon-192x192.png icon-192.png
   mv icon-512x512.png icon-512.png
   ```

2. Create placeholder maskable icons by copying existing (will be updated when brand assets available):
   ```bash
   cp icon-192.png icon-maskable-192.png
   cp icon-512.png icon-maskable-512.png
   ```

3. Create apple-touch-icon (180x180) by copying smallest icon:
   ```bash
   cp icon-192.png apple-touch-icon.png
   ```

Note: These are placeholder icons. When proper brand assets are created (with maskable-safe padding), they should replace these files. The file structure and manifest will be ready.
  </action>
  <verify>
List icons directory: `ls -la public/icons/` shows:
- icon-192.png
- icon-512.png
- icon-maskable-192.png
- icon-maskable-512.png
- apple-touch-icon.png
  </verify>
  <done>
Icon files renamed and placeholders created for all required sizes/purposes
  </done>
</task>

<task type="auto">
  <name>Task 2: Update PWA manifest with separated icon purposes</name>
  <files>public/manifest.json</files>
  <action>
Rewrite manifest.json with properly separated icon purposes:

```json
{
  "name": "Radl - Crew Team Management",
  "short_name": "Radl",
  "description": "Diligence wins. Manage your rowing team's schedule, lineups, and equipment.",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#0a0a0a",
  "theme_color": "#0d9488",
  "orientation": "portrait-primary",
  "scope": "/",
  "icons": [
    {
      "src": "/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any"
    },
    {
      "src": "/icons/icon-maskable-192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "maskable"
    },
    {
      "src": "/icons/icon-maskable-512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "maskable"
    }
  ]
}
```

Key changes:
- Split "any maskable" into separate icon entries
- Added maskable-specific icons with 40% safe zone consideration
- Renamed icon paths to match new file structure
- Kept all other fields unchanged (name, colors already correct)
  </action>
  <verify>
Validate manifest JSON: `cat public/manifest.json | jq .` parses successfully
Grep for separated purposes: `grep -c '"purpose"' public/manifest.json` returns 4 (two any, two maskable)
No combined purpose: `grep "any maskable" public/manifest.json` returns nothing
  </verify>
  <done>
Manifest has four icon entries with separated "any" and "maskable" purposes
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Apple touch icon to layout metadata</name>
  <files>src/app/layout.tsx</files>
  <action>
Update the metadata export to include icons configuration for Apple devices:

Add icons property to the metadata export:

```typescript
export const metadata: Metadata = {
  title: "Radl - Rowing Team Management",
  description: "Diligence wins. Manage your rowing team's schedule, lineups, and equipment.",
  manifest: "/manifest.json",
  appleWebApp: {
    capable: true,
    statusBarStyle: "black-translucent",
    title: "Radl",
  },
  icons: {
    icon: [
      { url: '/icons/icon-192.png', sizes: '192x192', type: 'image/png' },
      { url: '/icons/icon-512.png', sizes: '512x512', type: 'image/png' },
    ],
    apple: [
      { url: '/icons/apple-touch-icon.png', sizes: '180x180', type: 'image/png' },
    ],
  },
};
```

This adds:
- Standard favicon references (icon-192, icon-512)
- Apple touch icon reference for iOS home screen

Note: statusBarStyle should already be "black-translucent" from Plan 32-01. If not, update it here.
  </action>
  <verify>
Grep for apple icon: `grep -A2 "apple:" src/app/layout.tsx` shows apple-touch-icon reference
Build succeeds: `npm run build` completes without errors
  </verify>
  <done>
Layout metadata includes icons.apple configuration pointing to apple-touch-icon.png
  </done>
</task>

</tasks>

<verification>
1. All five icon files exist in public/icons/
2. Manifest JSON is valid and has 4 separate icon entries
3. No "any maskable" combined purpose in manifest
4. Layout metadata includes Apple touch icon reference
5. Build succeeds
</verification>

<success_criteria>
- BRND-03: App icons and favicons updated with brand assets (structure ready, placeholders in place)
- BRND-04: PWA manifest updated with correct name, colors, and icons (separated purposes)
- iOS and Android users see appropriate icon rendering
</success_criteria>

<output>
After completion, create `.planning/phases/32-safe-areas-branding/32-03-SUMMARY.md`
</output>
