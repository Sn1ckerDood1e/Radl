---
phase: 32-safe-areas-branding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/layout.tsx
  - src/app/(dashboard)/[teamSlug]/layout.tsx
  - src/components/layout/bottom-navigation.tsx
autonomous: true

must_haves:
  truths:
    - "User on iPhone 15 Pro sees full content without notch overlap"
    - "User with bottom navigation sees content above home indicator bar"
    - "Safe area insets activate on notched devices"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "Viewport configuration with viewportFit: cover"
      contains: "viewportFit: 'cover'"
    - path: "src/app/(dashboard)/[teamSlug]/layout.tsx"
      provides: "Bottom nav wrapper with safe area padding"
      contains: "pb-[env(safe-area-inset-bottom)]"
    - path: "src/components/layout/bottom-navigation.tsx"
      provides: "Bottom navigation component"
  key_links:
    - from: "src/app/layout.tsx"
      to: "viewport meta"
      via: "Next.js Viewport export"
      pattern: "viewportFit.*cover"
    - from: "src/app/(dashboard)/[teamSlug]/layout.tsx"
      to: "mobile bottom nav"
      via: "fixed nav wrapper"
      pattern: "safe-area-inset-bottom"
---

<objective>
Configure iOS safe areas for edge-to-edge display on notched devices.

Purpose: Ensure bottom navigation and content do not overlap with iPhone notch/Dynamic Island or home indicator gesture area.

Output: Updated viewport configuration and safe area padding on mobile navigation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-safe-areas-branding/32-RESEARCH.md

Key findings from research:
- viewport-fit: cover is MISSING (required to enable env() values)
- Bottom nav safe area is MISSING (needs pb-[env(safe-area-inset-bottom)])
- CSS utility classes .safe-area-inset-* already exist in globals.css (lines 217-222)
- statusBarStyle should be "black-translucent" for edge-to-edge PWA appearance
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure viewport for edge-to-edge display</name>
  <files>src/app/layout.tsx</files>
  <action>
Update the viewport export to enable safe area insets:

1. Expand the Viewport export (currently line 28-30) to include:
   - width: 'device-width'
   - initialScale: 1
   - maximumScale: 1
   - userScalable: false
   - viewportFit: 'cover' (CRITICAL - enables env() safe area values)
   - themeColor: '#0d9488' (keep existing)

2. Update appleWebApp.statusBarStyle from "default" to "black-translucent" for full-screen PWA appearance on iOS.

Result: The viewport meta tag will include viewport-fit=cover, enabling CSS env(safe-area-inset-*) to return actual values on notched devices.
  </action>
  <verify>
Build succeeds: `npm run build` in /home/hb/radl
Grep viewport config: `grep -A10 "export const viewport" src/app/layout.tsx` shows viewportFit: 'cover'
  </verify>
  <done>
Viewport export includes viewportFit: 'cover' and appleWebApp uses statusBarStyle: 'black-translucent'
  </done>
</task>

<task type="auto">
  <name>Task 2: Add safe area padding to bottom navigation wrapper</name>
  <files>src/app/(dashboard)/[teamSlug]/layout.tsx</files>
  <action>
Update the mobile bottom nav wrapper (line 96) to include safe area padding:

Before:
```tsx
<nav className="fixed bottom-0 left-0 right-0 z-50 md:hidden">
```

After:
```tsx
<nav className="fixed bottom-0 left-0 right-0 z-50 md:hidden pb-[env(safe-area-inset-bottom)]">
```

This adds padding-bottom using the env() value which:
- Returns the actual safe area inset on notched devices (34px on iPhone X+)
- Returns 0 on devices without a home indicator (no visual change)

Do NOT add the safe area class to the BottomNavigation component itself - the wrapper handles the spacing.
  </action>
  <verify>
Grep the nav wrapper: `grep -B1 -A1 "BottomNavigation" src/app/\\(dashboard\\)/\\[teamSlug\\]/layout.tsx` shows pb-[env(safe-area-inset-bottom)]
  </verify>
  <done>
Bottom nav wrapper has pb-[env(safe-area-inset-bottom)] class, pushing content above iOS home indicator
  </done>
</task>

</tasks>

<verification>
1. Build succeeds without errors
2. Viewport meta includes viewport-fit=cover (inspect generated HTML or check TypeScript export)
3. Bottom nav wrapper has safe area padding class
4. No TypeScript errors in modified files
</verification>

<success_criteria>
- SAFE-01: Viewport uses viewport-fit=cover for edge-to-edge (verified in layout.tsx export)
- SAFE-02: Content respects safe-area-inset-* (viewport-fit enables env() values)
- SAFE-03: Bottom navigation accounts for home indicator (pb-[env(safe-area-inset-bottom)] on wrapper)
</success_criteria>

<output>
After completion, create `.planning/phases/32-safe-areas-branding/32-01-SUMMARY.md`
</output>
