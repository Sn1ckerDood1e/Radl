---
phase: 38-facility-club-management
plan: 05
type: execute
wave: 2
depends_on: ["38-02"]
files_modified:
  - src/app/(admin)/admin/clubs/page.tsx
  - src/app/(admin)/admin/clubs/loading.tsx
  - src/app/(admin)/admin/clubs/[clubId]/page.tsx
  - src/app/(admin)/admin/clubs/[clubId]/loading.tsx
  - src/app/(admin)/admin/clubs/[clubId]/not-found.tsx
  - src/components/admin/clubs/club-list-table.tsx
  - src/components/admin/clubs/club-actions-dropdown.tsx
autonomous: true

must_haves:
  truths:
    - "Super admin can browse all clubs at /admin/clubs"
    - "Clubs can be filtered by facility"
    - "Club list shows name, facility, member count, created date"
    - "Super admin can click on club to see detail page"
    - "Club detail shows facility, member count, settings"
    - "Actions dropdown provides edit, move, and delete options"
  artifacts:
    - path: "src/app/(admin)/admin/clubs/page.tsx"
      provides: "Club list server component with facility filter"
      min_lines: 60
    - path: "src/app/(admin)/admin/clubs/[clubId]/page.tsx"
      provides: "Club detail server component"
      min_lines: 50
    - path: "src/components/admin/clubs/club-list-table.tsx"
      provides: "Table component for club list"
      exports: ["ClubListTable"]
    - path: "src/components/admin/clubs/club-actions-dropdown.tsx"
      provides: "Actions dropdown for club row"
      exports: ["ClubActionsDropdown"]
  key_links:
    - from: "src/app/(admin)/admin/clubs/page.tsx"
      to: "/api/admin/clubs"
      via: "Server component fetch with optional facilityId"
      pattern: "fetch.*api/admin/clubs"
    - from: "src/components/admin/clubs/club-actions-dropdown.tsx"
      to: "onMoveClick"
      via: "Callback for move dialog"
      pattern: "onMoveClick"
---

<objective>
Build club list and detail pages in the admin panel.

Purpose: Provide super admins with a browsable interface to view all clubs globally or filtered by facility, see club stats, and drill down into club details.

Output: Club list page with facility filter and club detail page (CLUB-01, CLUB-04 UI).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/38-facility-club-management/38-RESEARCH.md

Reference established admin UI patterns:
@src/app/(admin)/admin/users/page.tsx
@src/app/(admin)/admin/facilities/page.tsx (from 38-03)
@src/components/admin/users/user-list-table.tsx

API endpoints from 38-02:
- GET /api/admin/clubs (list, optional facilityId filter)
- GET /api/admin/clubs/[clubId] (detail)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create club list page with facility filter</name>
  <files>
    src/app/(admin)/admin/clubs/page.tsx
    src/app/(admin)/admin/clubs/loading.tsx
    src/components/admin/clubs/club-list-table.tsx
  </files>
  <action>
**page.tsx - Server component with URL-based facility filter:**

1. Parse searchParams for facilityId filter:
   ```typescript
   interface Props {
     searchParams: Promise<{ facilityId?: string }>;
   }
   ```

2. Fetch clubs with optional filter:
   ```typescript
   const params = facilityId ? `?facilityId=${facilityId}` : '';
   const res = await fetch(`${appUrl}/api/admin/clubs${params}`, ...);
   ```

3. Also fetch facilities list for filter dropdown:
   ```typescript
   const facilitiesRes = await fetch(`${appUrl}/api/admin/facilities`, ...);
   ```

4. Page layout:
   - Header: "Clubs" title with count badge
   - Filter row:
     - Facility filter dropdown (Select component with "All Facilities" option)
     - "Create Club" button linking to /admin/clubs/new
   - ClubListTable component
   - Empty state if no clubs

5. Facility filter is URL-based:
   - Selecting a facility navigates to ?facilityId=xxx
   - "All Facilities" navigates to /admin/clubs (no param)

**ClubListTable client component:**
- Props: `clubs` array (with facility info)
- Columns: Name (link), Facility (link to facility), Members, Join Code, Created, Actions
- Each row shows:
  - Name as link to /admin/clubs/[id]
  - Facility name as link to /admin/facilities/[facilityId]
  - Member count
  - Join code (monospace font, for reference)
  - Created date
  - ClubActionsDropdown
- Hover highlight on rows

**loading.tsx:** Skeleton with filter dropdown and table

Per CONTEXT.md: "Clubs grouped by facility with collapsible sections" - but simple table with facility column is cleaner for admin. Filter dropdown achieves same goal.
  </action>
  <verify>`cd /home/hb/radl && npx tsc --noEmit src/app/(admin)/admin/clubs/page.tsx`</verify>
  <done>Club list page renders with facility filter dropdown working</done>
</task>

<task type="auto">
  <name>Task 2: Create club actions dropdown</name>
  <files>src/components/admin/clubs/club-actions-dropdown.tsx</files>
  <action>
Create client component:

**Props:**
- clubId: string
- clubName: string
- facilityId: string
- onMoveClick: () => void (triggers move dialog in parent)
- onDeleteClick: () => void (triggers delete dialog in parent)

**Dropdown items:**
1. "View Details" - navigates to /admin/clubs/[id]
2. "Edit" - navigates to /admin/clubs/[id]/edit
3. Separator
4. "Move to Another Facility" - calls onMoveClick prop
5. "Delete" (destructive) - calls onDeleteClick prop

Use DropdownMenu with MoreHorizontal trigger (matching facility pattern).

Note: Move and delete dialogs will be in parent component (handled in 38-06).
  </action>
  <verify>Component exports correctly; dropdown has all 4 actions</verify>
  <done>Dropdown renders all actions; move and delete trigger callbacks</done>
</task>

<task type="auto">
  <name>Task 3: Create club detail page</name>
  <files>
    src/app/(admin)/admin/clubs/[clubId]/page.tsx
    src/app/(admin)/admin/clubs/[clubId]/loading.tsx
    src/app/(admin)/admin/clubs/[clubId]/not-found.tsx
  </files>
  <action>
**page.tsx - Server component:**

1. Extract clubId from params
2. Fetch club detail:
   ```typescript
   const res = await fetch(`${appUrl}/api/admin/clubs/${clubId}`, ...);
   ```
3. Return notFound() if 404

4. Layout:
   - Breadcrumb: Clubs > [Club Name]
   - Header row:
     - Club name
     - "Edit" button
     - Facility badge/link (shows which facility this club belongs to)
   - Stats row:
     - Member count
     - Equipment count (if available)
     - Created date
   - Info section:
     - Join Code (displayed for admin reference, helps with onboarding)
     - Slug
   - Settings section (if settings exist):
     - Damage notification user IDs count
     - Readiness thresholds

**loading.tsx:** Skeleton matching layout

**not-found.tsx:** Standard "Club not found" with back link

Note: Member list is Phase 39. This page shows counts only.
  </action>
  <verify>Page renders club details including facility link and join code</verify>
  <done>Detail page shows all club info with facility context</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `cd /home/hb/radl && npm run build` succeeds
2. /admin/clubs shows club list with facility filter
3. Selecting facility in dropdown filters the list
4. Clicking club name navigates to detail page
5. Detail page shows facility association and stats
</verification>

<success_criteria>
- Super admin can browse /admin/clubs and see all clubs
- Facility filter dropdown filters list by selected facility
- Each row shows club name, facility, member count, join code
- Clicking club name opens detail page
- Detail page shows full club info including facility link
- Actions dropdown triggers callbacks for move/delete
</success_criteria>

<output>
After completion, create `.planning/phases/38-facility-club-management/38-05-SUMMARY.md`
</output>
