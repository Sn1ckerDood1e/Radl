---
phase: 38-facility-club-management
plan: 03
type: execute
wave: 2
depends_on: ["38-01"]
files_modified:
  - src/app/(admin)/admin/facilities/page.tsx
  - src/app/(admin)/admin/facilities/loading.tsx
  - src/app/(admin)/admin/facilities/[facilityId]/page.tsx
  - src/app/(admin)/admin/facilities/[facilityId]/loading.tsx
  - src/app/(admin)/admin/facilities/[facilityId]/not-found.tsx
  - src/components/admin/facilities/facility-list-table.tsx
  - src/components/admin/facilities/facility-actions-dropdown.tsx
autonomous: true

must_haves:
  truths:
    - "Super admin can browse paginated facility list at /admin/facilities"
    - "Facility list shows name, club count, member count, location, created date"
    - "Super admin can click on facility to see detail page"
    - "Facility detail shows all clubs with member counts"
    - "Actions dropdown provides links to edit and delete"
  artifacts:
    - path: "src/app/(admin)/admin/facilities/page.tsx"
      provides: "Facility list server component"
      min_lines: 50
    - path: "src/app/(admin)/admin/facilities/[facilityId]/page.tsx"
      provides: "Facility detail server component"
      min_lines: 50
    - path: "src/components/admin/facilities/facility-list-table.tsx"
      provides: "Table component for facility list"
      exports: ["FacilityListTable"]
    - path: "src/components/admin/facilities/facility-actions-dropdown.tsx"
      provides: "Actions dropdown for facility row"
      exports: ["FacilityActionsDropdown"]
  key_links:
    - from: "src/app/(admin)/admin/facilities/page.tsx"
      to: "/api/admin/facilities"
      via: "Server component fetch with cookie forwarding"
      pattern: "fetch.*api/admin/facilities"
    - from: "src/components/admin/facilities/facility-actions-dropdown.tsx"
      to: "router.push"
      via: "Navigation to edit page"
      pattern: "router\\.push"
---

<objective>
Build facility list and detail pages in the admin panel.

Purpose: Provide super admins with a browsable interface to view all facilities, their stats, and drill down into facility details showing clubs.

Output: Facility list page with table component and facility detail page (FCLT-01, FCLT-04 UI).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/38-facility-club-management/38-RESEARCH.md

Reference established admin UI patterns:
@src/app/(admin)/admin/users/page.tsx
@src/app/(admin)/admin/users/[userId]/page.tsx
@src/components/admin/users/user-list-table.tsx
@src/components/admin/users/user-actions-dropdown.tsx

API endpoints from 38-01:
- GET /api/admin/facilities (list)
- GET /api/admin/facilities/[facilityId] (detail)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create facility list page with table</name>
  <files>
    src/app/(admin)/admin/facilities/page.tsx
    src/app/(admin)/admin/facilities/loading.tsx
    src/components/admin/facilities/facility-list-table.tsx
  </files>
  <action>
**page.tsx - Server component following user list pattern:**

1. Create async function to fetch facilities:
   ```typescript
   async function getFacilities() {
     const cookieStore = await cookies();
     const cookieHeader = cookieStore.getAll().map(c => `${c.name}=${c.value}`).join('; ');
     const appUrl = process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000';

     const res = await fetch(`${appUrl}/api/admin/facilities`, {
       headers: { Cookie: cookieHeader },
       cache: 'no-store',
     });

     if (!res.ok) return null;
     return res.json();
   }
   ```

2. Page component:
   - Fetch facilities
   - Display header with title "Facilities" and count badge
   - "Create Facility" button linking to /admin/facilities/new
   - Render FacilityListTable component with facilities data
   - Empty state if no facilities

**FacilityListTable client component:**
- Props: `facilities` array
- Columns: Name (link), Location (city, state), Clubs, Members, Created, Actions
- Each row shows:
  - Name as link to /admin/facilities/[id]
  - Location: city + state or "-" if empty
  - Club count
  - Member count (calculated from sum of club memberships)
  - Created date (formatted)
  - FacilityActionsDropdown
- Hover highlight on rows

**loading.tsx:**
- Skeleton loader matching table layout

Follow existing patterns from user-list-table.tsx for styling and structure.
  </action>
  <verify>`cd /home/hb/radl && npx tsc --noEmit src/app/(admin)/admin/facilities/page.tsx`</verify>
  <done>Facility list page renders table with all columns; clicking name navigates to detail</done>
</task>

<task type="auto">
  <name>Task 2: Create facility actions dropdown</name>
  <files>src/components/admin/facilities/facility-actions-dropdown.tsx</files>
  <action>
Create client component following user-actions-dropdown pattern:

**Props:**
- facilityId: string
- facilityName: string (for delete confirmation)
- onDeleteClick: () => void (to trigger parent's delete dialog)

**Dropdown items:**
1. "View Details" - navigates to /admin/facilities/[id]
2. "Edit" - navigates to /admin/facilities/[id]/edit
3. Separator
4. "Delete" (destructive) - calls onDeleteClick prop

Use DropdownMenu from shadcn/ui with MoreHorizontal icon trigger.

Note: Actual delete dialog will be in parent component (plan 38-04), this just triggers it.
  </action>
  <verify>Component exports correctly; TypeScript compiles</verify>
  <done>Dropdown renders three actions; delete triggers callback</done>
</task>

<task type="auto">
  <name>Task 3: Create facility detail page</name>
  <files>
    src/app/(admin)/admin/facilities/[facilityId]/page.tsx
    src/app/(admin)/admin/facilities/[facilityId]/loading.tsx
    src/app/(admin)/admin/facilities/[facilityId]/not-found.tsx
  </files>
  <action>
**page.tsx - Server component:**

1. Extract facilityId from params
2. Fetch facility detail from API:
   ```typescript
   const res = await fetch(`${appUrl}/api/admin/facilities/${facilityId}`, {
     headers: { Cookie: cookieHeader },
     cache: 'no-store',
   });
   ```
3. Return notFound() if 404

4. Layout:
   - Breadcrumb: Facilities > [Facility Name]
   - Header: Facility name, "Edit" button, location subtitle
   - Stats row: Club count, Member count, Created date
   - Contact info section (if has phone/email/website)
   - Clubs section:
     - Table of clubs in this facility
     - Columns: Name (link to /admin/clubs/[id]), Members, Created
     - Empty state if no clubs
     - "Create Club" button linking to /admin/clubs/new?facilityId=[id]

**loading.tsx:** Skeleton with stat cards and table outline

**not-found.tsx:** Standard "Facility not found" message with back link
  </action>
  <verify>Page renders facility details with clubs table</verify>
  <done>Detail page shows all facility info and nested clubs list</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `cd /home/hb/radl && npm run build` succeeds
2. /admin/facilities shows facility list with stats
3. Clicking facility name navigates to detail page
4. Detail page shows clubs nested under facility
5. Actions dropdown works (delete triggers callback)
</verification>

<success_criteria>
- Super admin can browse /admin/facilities and see table with all facilities
- Each row shows name, location, club count, member count, created date
- Clicking facility name opens detail page
- Detail page shows facility info, stats, and clubs list
- Loading and not-found states work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/38-facility-club-management/38-03-SUMMARY.md`
</output>
