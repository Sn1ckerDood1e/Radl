---
phase: 38-facility-club-management
plan: 06
type: execute
wave: 2
depends_on: ["38-02", "38-04"]
files_modified:
  - src/app/(admin)/admin/clubs/new/page.tsx
  - src/app/(admin)/admin/clubs/[clubId]/edit/page.tsx
  - src/components/admin/clubs/club-form.tsx
  - src/components/admin/clubs/move-club-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "Super admin can create a new club via form"
    - "Super admin can edit existing club details"
    - "Club creation requires selecting a facility"
    - "Super admin can move club to different facility via dialog"
    - "Move dialog shows impact summary before confirmation"
    - "Delete requires typing club name to confirm"
  artifacts:
    - path: "src/app/(admin)/admin/clubs/new/page.tsx"
      provides: "Create club page"
      min_lines: 30
    - path: "src/app/(admin)/admin/clubs/[clubId]/edit/page.tsx"
      provides: "Edit club page with danger zone"
      min_lines: 50
    - path: "src/components/admin/clubs/club-form.tsx"
      provides: "Shared create/edit form component"
      exports: ["ClubForm"]
    - path: "src/components/admin/clubs/move-club-dialog.tsx"
      provides: "Dialog for moving club between facilities"
      exports: ["MoveClubDialog"]
  key_links:
    - from: "src/components/admin/clubs/club-form.tsx"
      to: "/api/admin/clubs"
      via: "POST/PATCH fetch"
      pattern: "fetch.*api/admin/clubs"
    - from: "src/components/admin/clubs/move-club-dialog.tsx"
      to: "/api/admin/clubs/[id]/move"
      via: "POST to move endpoint"
      pattern: "api/admin/clubs.*move"
---

<objective>
Build club create/edit forms, move dialog, and delete confirmation.

Purpose: Enable super admins to fully manage clubs including creation with facility assignment, editing, moving between facilities, and safe deletion.

Output: Create page, edit page with danger zone, shared form, and move dialog (CLUB-02, CLUB-03, CLUB-05, CLUB-06 UI).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/38-facility-club-management/38-RESEARCH.md
@.planning/phases/38-facility-club-management/38-CONTEXT.md

Reference from 38-04:
@src/components/admin/type-to-confirm-dialog.tsx
@src/components/admin/facilities/facility-form.tsx

Validation schemas from 38-02:
@src/lib/validations/club.ts

API endpoints:
- POST /api/admin/clubs (create)
- PATCH /api/admin/clubs/[id] (update)
- DELETE /api/admin/clubs/[id] (delete with confirmation)
- POST /api/admin/clubs/[id]/move (move to new facility)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared club form component</name>
  <files>src/components/admin/clubs/club-form.tsx</files>
  <action>
Create client component following FacilityForm pattern:

**Props:**
- mode: 'create' | 'edit'
- clubId?: string (required for edit)
- defaultValues?: Partial<ClubFormData>
- facilities: Array<{ id: string; name: string }> (for facility select)
- preselectedFacilityId?: string (from URL param on create)

**Form fields:**
- Name (required)
- Slug (optional, auto-generated from name on create)
- Facility (Select dropdown, required on create, disabled on edit - use move dialog instead)

Note: Per CONTEXT.md, team colors are deferred. primaryColor and secondaryColor use defaults in API.

**Behavior:**
- Use mode: 'onTouched', reValidateMode: 'onChange'
- On name blur in create mode, auto-generate slug if empty
- Facility field disabled in edit mode with note "Use 'Move' action to change facility"
- On submit:
  - POST to /api/admin/clubs (create)
  - PATCH to /api/admin/clubs/[id] (edit)
  - Success toast and redirect to /admin/clubs
  - Error toast with retry on failure

**Form layout:**
- Basic Info section: Name, Slug
- Facility section (create only): Facility dropdown
- For edit: Read-only facility display with badge
  </action>
  <verify>Form handles create with facility selection and edit with disabled facility</verify>
  <done>Form submits correctly; facility selection works on create</done>
</task>

<task type="auto">
  <name>Task 2: Create move club dialog</name>
  <files>src/components/admin/clubs/move-club-dialog.tsx</files>
  <action>
Create dialog component for CLUB-06 (move club between facilities):

**Props:**
- open: boolean
- onOpenChange: (open: boolean) => void
- club: { id: string; name: string; facilityId: string; memberCount: number }
- facilities: Array<{ id: string; name: string }> (all facilities for selection)
- currentFacilityName: string
- onSuccess: () => void (callback after successful move)

**Dialog content:**
1. Title: "Move Club to Another Facility"
2. Description: "Moving {clubName} from {currentFacilityName}"
3. Select dropdown for target facility (exclude current facility from options)
4. Impact summary:
   - "{memberCount} members will be transferred with this club"
   - "Club-owned equipment will move with the club"
   - "Facility equipment remains at the original facility"
5. Confirm button (disabled until facility selected)
6. Cancel button

**On confirm:**
1. POST to /api/admin/clubs/[id]/move with { targetFacilityId }
2. Show loading state
3. On success: toast success, call onSuccess prop
4. On error: toast error with message

**UI considerations:**
- Use Dialog from shadcn/ui
- Select component for facility dropdown
- Button for confirmation
- Loading state on button during API call
  </action>
  <verify>Dialog allows selecting facility and calls move API</verify>
  <done>Move dialog shows impact and calls API on confirm</done>
</task>

<task type="auto">
  <name>Task 3: Create club new and edit pages</name>
  <files>
    src/app/(admin)/admin/clubs/new/page.tsx
    src/app/(admin)/admin/clubs/[clubId]/edit/page.tsx
  </files>
  <action>
**new/page.tsx - Server component:**

1. Parse searchParams for optional facilityId (from facility detail page link)
2. Fetch facilities list for dropdown
3. Render:
   ```tsx
   <div className="max-w-2xl">
     <h1 className="text-2xl font-bold mb-6">Create Club</h1>
     <ClubForm
       mode="create"
       facilities={facilities}
       preselectedFacilityId={facilityId}
     />
   </div>
   ```

**[clubId]/edit/page.tsx - Server component:**

1. Extract clubId from params
2. Fetch club detail and facilities list (parallel)
3. Return notFound() if club not found

4. State management (client wrapper needed):
   - Create ClubEditClient component that handles:
     - Move dialog state (open/close)
     - Delete dialog state (open/close)
     - Delete cascade info fetching

5. Layout:
   - Breadcrumb: Clubs > [Club Name] > Edit
   - Header with club name
   - ClubForm with mode="edit"
   - Separator
   - "Danger Zone" section (red-bordered card):
     - "Move Club" button - opens MoveClubDialog
     - "Delete Club" button:
       1. Fetches cascade info from DELETE /api/admin/clubs/[id]
       2. Opens TypeToConfirmDialog with cascade warning
       3. On confirm, calls DELETE with ?confirm=true
       4. On success, redirects to /admin/clubs

**ClubEditClient wrapper component (in same file or separate):**
- Manages dialog states
- Handles delete flow (fetch cascade, show dialog, confirm)
- Handles move flow (show dialog, on success refresh)
  </action>
  <verify>Create page has facility dropdown; edit page has move and delete in danger zone</verify>
  <done>Both pages work; move dialog and delete dialog function correctly</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `cd /home/hb/radl && npm run build` succeeds
2. /admin/clubs/new shows form with facility dropdown
3. ?facilityId param pre-selects facility
4. /admin/clubs/[id]/edit shows form with disabled facility
5. Move button opens dialog with target facility selection
6. Delete button shows type-to-confirm with cascade warning
7. Move and delete operations complete successfully
</verification>

<success_criteria>
- Super admin can create club with facility selection
- Pre-selected facility from URL param works
- Super admin can edit club details (except facility)
- Move dialog allows selecting different facility
- Move shows impact summary (member count)
- Delete requires typing exact club name
- Delete shows cascade warning (members, equipment counts)
- All operations show appropriate success/error feedback
</success_criteria>

<output>
After completion, create `.planning/phases/38-facility-club-management/38-06-SUMMARY.md`
</output>
