---
phase: 23-dashboard-enhancements
plan: 06
type: execute
wave: 3
depends_on: [23-04, 23-05]
files_modified:
  - src/app/(dashboard)/[teamSlug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard routes to CoachDashboard or AthleteDashboard based on user role"
    - "Data fetched in parallel using Promise.all"
    - "Coach sees Today's Schedule hero, Fleet Health, Usage Trends, Quick Actions"
    - "Athlete sees Next Practice hero with assignment, Announcements"
  artifacts:
    - path: "src/app/(dashboard)/[teamSlug]/page.tsx"
      provides: "Team dashboard page with role-based routing"
      exports: ["default"]
  key_links:
    - from: "src/app/(dashboard)/[teamSlug]/page.tsx"
      to: "Dashboard queries"
      via: "imports and calls"
      pattern: "import.*(getTodaysPractices|getAthleteNextPractice|getAttentionItems)"
    - from: "src/app/(dashboard)/[teamSlug]/page.tsx"
      to: "Dashboard components"
      via: "conditional rendering"
      pattern: "isCoach.*CoachDashboard|AthleteDashboard"
---

<objective>
Integrate the new dashboard components and queries into the main team page, replacing the existing unified dashboard with role-specific layouts.

Purpose: This is the final integration that makes the dashboard enhancements live. Coaches and athletes see completely different, optimized views.
Output: Working dashboard page with role-based routing and parallel data fetching.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/23-dashboard-enhancements/23-CONTEXT.md
@.planning/phases/23-dashboard-enhancements/23-RESEARCH.md
@src/app/(dashboard)/[teamSlug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor dashboard page with role-based routing</name>
  <files>src/app/(dashboard)/[teamSlug]/page.tsx</files>
  <action>
Refactor the existing dashboard page to use role-specific dashboard components.

Changes:

1. Add imports for new dashboard components and queries:
```typescript
import { CoachDashboard } from '@/components/dashboard/coach-dashboard';
import { AthleteDashboard } from '@/components/dashboard/athlete-dashboard';
import { getTodaysPracticesForCoach, getAttentionItems, getUsageTrendsData, getAthleteNextPractice } from '@/lib/dashboard/queries';
```

2. Modify data fetching to be role-aware:
- Keep existing auth and team lookup logic (unchanged)
- After determining isCoach, fetch role-specific data in parallel:

For coaches:
```typescript
const [
  { practices: todaysPractices, nextPractice },
  attentionItems,
  { sparklineData, totalHours, seasonName },
  // existing: equipment for fleet health, announcements
] = await Promise.all([
  getTodaysPracticesForCoach(teamId),
  getAttentionItems(teamId, teamSlug),
  getUsageTrendsData(teamId),
  // ... existing queries for fleet health and announcements
]);
```

For athletes:
```typescript
const [
  { practice: nextPractice, assignment, unassignedPracticeCount },
  // announcements
] = await Promise.all([
  getAthleteNextPractice(teamId, user.id),
  // ... announcements query
]);
```

3. Replace the single dashboardContent with conditional rendering:
```typescript
return (
  <DashboardWithOnboarding teamId={team.id} teamName={team.name} isCoach={isCoach}>
    {isCoach ? (
      <CoachDashboard
        teamSlug={teamSlug}
        todaysPractices={todaysPractices}
        nextPractice={nextPractice}
        statusCounts={fleetHealthCounts}
        totalEquipment={totalEquipment}
        sparklineData={sparklineData}
        totalUsageHours={totalHours}
        seasonName={seasonName}
        attentionItems={attentionItems}
        announcements={announcements}
        openDamageReportCount={openDamageReportCount}
      />
    ) : (
      <AthleteDashboard
        teamSlug={teamSlug}
        nextPractice={nextPractice}
        assignment={assignment}
        unassignedPracticeCount={unassignedPracticeCount}
        announcements={announcements}
      />
    )}
  </DashboardWithOnboarding>
);
```

4. Keep the DashboardWithOnboarding wrapper (existing behavior).

5. Remove the inline dashboardContent JSX that's being replaced.

6. Optimize athlete data fetching - athletes don't need:
   - Equipment fleet health data
   - Usage trends data
   - Open damage report count
   - Attention items

Note: Preserve existing error handling and redirect logic.
  </action>
  <verify>
- `npx tsc --noEmit` passes
- `npm run dev` - dashboard loads for both coach and athlete roles
- Coach sees: Today's Schedule, Fleet Health, Usage Trends, Quick Actions, Announcements
- Athlete sees: Next Practice with assignment, Announcements
  </verify>
  <done>
Dashboard page routes to role-specific layouts with appropriate data fetching.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete dashboard enhancement integration:
- Coach dashboard with Today's Schedule hero, Fleet Health, Usage Trends sparkline, Quick Actions
- Athlete dashboard with Next Practice hero showing their assignment
- Role-based routing from main dashboard page
  </what-built>
  <how-to-verify>
1. Log in as a coach and navigate to team dashboard
2. Verify you see:
   - Today's Schedule widget at top (hero)
   - Fleet Health and Usage Trends side by side
   - Quick Actions showing any attention items
   - Announcements at bottom
3. Log in as an athlete and navigate to team dashboard
4. Verify you see:
   - Next Practice widget showing your assignment (boat/seat or erg)
   - Announcements (if any)
   - NO fleet health, usage trends, or quick actions (athlete view is simpler)
5. Test empty states:
   - Coach with no practices today should see "Next practice" fallback
   - Athlete with no assignments should see "not assigned yet" message
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- TypeScript compilation succeeds: `npx tsc --noEmit`
- Development server runs without errors: `npm run dev`
- Coach dashboard shows all 4 widgets in priority order
- Athlete dashboard shows simplified focused view
- Both roles see announcements
- Empty states handled gracefully
</verification>

<success_criteria>
- Coach sees: Today's Schedule (hero) -> Fleet Health + Usage Trends (grid) -> Quick Actions -> Announcements
- Athlete sees: Next Practice (hero) with their assignment -> Announcements
- Data fetched in parallel (no sequential queries)
- Role-specific data fetching (athletes don't query coach-only data)
- Visual verification from human confirms layout and content
</success_criteria>

<output>
After completion, create `.planning/phases/23-dashboard-enhancements/23-06-SUMMARY.md`
</output>
