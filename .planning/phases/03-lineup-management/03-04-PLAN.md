---
phase: 03-lineup-management
plan: 04
type: execute
wave: 2
depends_on: [03-01]
files_modified:
  - package.json
  - src/components/lineups/athlete-roster-panel.tsx
  - src/components/lineups/seat-slot.tsx
  - src/components/lineups/draggable-athlete.tsx
  - src/components/lineups/athlete-card.tsx
autonomous: true

must_haves:
  truths:
    - "dnd-kit packages installed and working"
    - "Athletes can be dragged from roster panel"
    - "Seat slots accept dropped athletes"
    - "Drag overlay shows athlete card during drag"
  artifacts:
    - path: "package.json"
      provides: "dnd-kit dependencies added"
      contains: "@dnd-kit/core"
    - path: "src/components/lineups/athlete-roster-panel.tsx"
      provides: "Scrollable list of draggable athletes"
      exports: ["AthleteRosterPanel"]
    - path: "src/components/lineups/seat-slot.tsx"
      provides: "Droppable seat position component"
      exports: ["SeatSlot"]
    - path: "src/components/lineups/draggable-athlete.tsx"
      provides: "Draggable wrapper for athletes in roster"
      exports: ["DraggableAthlete"]
    - path: "src/components/lineups/athlete-card.tsx"
      provides: "Presentational athlete card (no drag hooks)"
      exports: ["AthleteCard", "AthleteCardSkeleton"]
  key_links:
    - from: "src/components/lineups/draggable-athlete.tsx"
      to: "@dnd-kit/sortable"
      via: "useSortable hook"
      pattern: "useSortable"
    - from: "src/components/lineups/seat-slot.tsx"
      to: "@dnd-kit/core"
      via: "useDroppable hook"
      pattern: "useDroppable"
---

<objective>
Install dnd-kit and create the foundational drag-and-drop components for the lineup editor.

Purpose: The lineup editor needs drag-and-drop infrastructure before building the full water lineup builder. These components are reusable and follow dnd-kit best practices.
Output: Working drag-and-drop primitives that can be composed into the lineup editor.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-lineup-management/03-CONTEXT.md
@.planning/phases/03-lineup-management/03-RESEARCH.md

# Existing patterns
@src/components/practices/block-editor.tsx
@src/components/athletes/athlete-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dnd-kit packages</name>
  <files>package.json</files>
  <action>
Install dnd-kit packages for drag-and-drop:

Run: `npm install @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities`

These packages provide:
- @dnd-kit/core: Base DndContext, DragOverlay, sensors
- @dnd-kit/sortable: useSortable hook, SortableContext
- @dnd-kit/utilities: CSS.Transform helper

Version requirements: Latest stable (6.x for core, 8.x for sortable, 3.x for utilities)

After installation, verify imports work:
```typescript
import { DndContext, DragOverlay } from '@dnd-kit/core';
import { SortableContext, useSortable } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';
```
  </action>
  <verify>
Run `npm ls @dnd-kit/core` - shows installed version
Run `npx tsc --noEmit` - no import errors
  </verify>
  <done>dnd-kit packages installed and importable</done>
</task>

<task type="auto">
  <name>Task 2: Create athlete presentation and draggable components</name>
  <files>src/components/lineups/athlete-card.tsx, src/components/lineups/draggable-athlete.tsx</files>
  <action>
Create src/components/lineups/athlete-card.tsx:

This is a PRESENTATION component with NO drag hooks. Used in:
- Roster panel (wrapped by DraggableAthlete)
- DragOverlay (rendered directly, no hooks)
- Seat slots (showing assigned athlete)

```typescript
interface AthleteCardProps {
  athlete: {
    id: string;
    displayName: string | null;
    sidePreference?: 'PORT' | 'STARBOARD' | 'BOTH' | null;
  };
  compact?: boolean; // Smaller variant for seat slots
  isDragging?: boolean; // Visual feedback during drag
}

export function AthleteCard({ athlete, compact, isDragging }: AthleteCardProps) {
  // Display name with fallback
  // Side preference indicator (P/S/B icon or color)
  // Compact mode: just name, smaller padding
  // isDragging: slight opacity/scale change
}

export function AthleteCardSkeleton() {
  // Loading placeholder
}
```

Visual design:
- Match existing card styles (bg-zinc-800, rounded-lg)
- Side preference: small badge or color-coded left border
  - PORT: blue-500
  - STARBOARD: green-500
  - BOTH: purple-500
  - None: no indicator
- Compact: py-1.5 px-2, smaller text
- Normal: py-2 px-3

Create src/components/lineups/draggable-athlete.tsx:

```typescript
import { useSortable } from '@dnd-kit/sortable';
import { CSS } from '@dnd-kit/utilities';
import { AthleteCard } from './athlete-card';

interface DraggableAthleteProps {
  athlete: AthleteCardProps['athlete'];
  disabled?: boolean; // For already-assigned athletes if filter is off
}

export function DraggableAthlete({ athlete, disabled }: DraggableAthleteProps) {
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: athlete.id, disabled });

  const style = {
    transform: CSS.Transform.toString(transform),
    transition,
  };

  return (
    <div
      ref={setNodeRef}
      style={style}
      {...attributes}
      {...listeners}
      className={disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-grab active:cursor-grabbing'}
    >
      <AthleteCard athlete={athlete} isDragging={isDragging} />
    </div>
  );
}
```

IMPORTANT: AthleteCard must NOT call any hooks - it's used in DragOverlay which can't have useSortable.
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>Athlete card and draggable wrapper components created</done>
</task>

<task type="auto">
  <name>Task 3: Create roster panel and seat slot components</name>
  <files>src/components/lineups/athlete-roster-panel.tsx, src/components/lineups/seat-slot.tsx</files>
  <action>
Create src/components/lineups/athlete-roster-panel.tsx:

```typescript
import { SortableContext, verticalListSortingStrategy } from '@dnd-kit/sortable';
import { DraggableAthlete } from './draggable-athlete';

interface Athlete {
  id: string;
  displayName: string | null;
  sidePreference?: 'PORT' | 'STARBOARD' | 'BOTH' | null;
}

interface AthleteRosterPanelProps {
  athletes: Athlete[];
  assignedAthleteIds: Set<string>; // Athletes already in lineup
  showAssigned?: boolean; // Toggle to show/hide assigned athletes
  searchQuery?: string;
  onSearchChange?: (query: string) => void;
}

export function AthleteRosterPanel({
  athletes,
  assignedAthleteIds,
  showAssigned = false,
  searchQuery = '',
  onSearchChange,
}: AthleteRosterPanelProps) {
  // Filter athletes:
  // 1. By search query (displayName contains)
  // 2. By assigned status (hide if assigned and !showAssigned)
  const filtered = athletes.filter(a => {
    const matchesSearch = !searchQuery ||
      a.displayName?.toLowerCase().includes(searchQuery.toLowerCase());
    const isAssigned = assignedAthleteIds.has(a.id);
    const showThisAthlete = !isAssigned || showAssigned;
    return matchesSearch && showThisAthlete;
  });

  const athleteIds = filtered.map(a => a.id);

  return (
    <div className="flex flex-col h-full">
      {/* Search input */}
      <div className="p-2 border-b border-zinc-700">
        <input
          type="text"
          placeholder="Search athletes..."
          value={searchQuery}
          onChange={(e) => onSearchChange?.(e.target.value)}
          className="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-sm"
        />
      </div>

      {/* Toggle for showing assigned */}
      <div className="px-2 py-1.5 border-b border-zinc-700">
        <label className="flex items-center gap-2 text-xs text-zinc-400">
          <input
            type="checkbox"
            checked={showAssigned}
            onChange={(e) => {/* parent controls this */}}
            className="rounded border-zinc-600"
          />
          Show assigned athletes
        </label>
      </div>

      {/* Scrollable athlete list */}
      <div className="flex-1 overflow-y-auto p-2 space-y-1.5">
        <SortableContext items={athleteIds} strategy={verticalListSortingStrategy}>
          {filtered.map(athlete => (
            <DraggableAthlete
              key={athlete.id}
              athlete={athlete}
              disabled={assignedAthleteIds.has(athlete.id) && showAssigned}
            />
          ))}
        </SortableContext>

        {filtered.length === 0 && (
          <p className="text-center text-zinc-500 text-sm py-4">
            {searchQuery ? 'No athletes match search' : 'No athletes available'}
          </p>
        )}
      </div>
    </div>
  );
}
```

Create src/components/lineups/seat-slot.tsx:

```typescript
import { useDroppable } from '@dnd-kit/core';
import { AthleteCard } from './athlete-card';

interface SeatSlotProps {
  seatId: string; // e.g., "seat-1", "seat-bow"
  position: number;
  label: string; // "Bow", "2", "Stroke", "Cox"
  side: 'PORT' | 'STARBOARD' | 'NONE';
  athlete?: {
    id: string;
    displayName: string | null;
    sidePreference?: 'PORT' | 'STARBOARD' | 'BOTH' | null;
  } | null;
  onRemove?: () => void; // Remove athlete from seat
}

export function SeatSlot({ seatId, position, label, side, athlete, onRemove }: SeatSlotProps) {
  const { isOver, setNodeRef } = useDroppable({ id: seatId });

  // Side color indicator
  const sideColor = side === 'PORT'
    ? 'border-l-blue-500'
    : side === 'STARBOARD'
    ? 'border-l-green-500'
    : '';

  return (
    <div
      ref={setNodeRef}
      className={`
        p-2 rounded-lg border-2 border-l-4 min-h-[60px]
        ${isOver ? 'border-emerald-500 bg-emerald-500/10' : 'border-zinc-700 bg-zinc-800/50'}
        ${sideColor}
        transition-colors
      `}
    >
      {/* Seat label */}
      <div className="text-xs text-zinc-500 mb-1 flex justify-between items-center">
        <span>{label}</span>
        {athlete && onRemove && (
          <button
            type="button"
            onClick={onRemove}
            className="text-zinc-500 hover:text-red-400 transition-colors"
          >
            <X className="h-3.5 w-3.5" />
          </button>
        )}
      </div>

      {/* Athlete or empty state */}
      {athlete ? (
        <AthleteCard athlete={athlete} compact />
      ) : (
        <div className="h-8 flex items-center justify-center text-zinc-600 text-sm border border-dashed border-zinc-700 rounded">
          Drop athlete
        </div>
      )}
    </div>
  );
}
```

Import X icon from lucide-react in seat-slot.tsx.
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors
Components can be imported without errors
  </verify>
  <done>Roster panel and seat slot components created with drag-drop integration</done>
</task>

</tasks>

<verification>
All checks must pass:
1. `npm ls @dnd-kit/core` - shows installed
2. `npx tsc --noEmit` - TypeScript compiles
3. Components export correctly and can be imported
4. AthleteCard has no hooks (safe for DragOverlay)
5. DraggableAthlete uses useSortable correctly
6. SeatSlot uses useDroppable correctly
7. AthleteRosterPanel wraps athletes in SortableContext
</verification>

<success_criteria>
- dnd-kit packages installed
- AthleteCard is presentation-only (no hooks)
- DraggableAthlete wraps athletes with useSortable
- SeatSlot accepts drops via useDroppable
- AthleteRosterPanel provides filterable athlete list
- Components follow dnd-kit best practices from research
</success_criteria>

<output>
After completion, create `.planning/phases/03-lineup-management/03-04-SUMMARY.md`
</output>
