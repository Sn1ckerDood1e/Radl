---
phase: 05-regatta-mode
plan: 05
type: execute
wave: 3
depends_on: ["05-02", "05-04"]
files_modified:
  - src/components/regatta/race-timeline.tsx
  - src/components/regatta/entry-card.tsx
  - src/app/(dashboard)/[teamSlug]/regattas/page.tsx
  - src/app/(dashboard)/[teamSlug]/regattas/[id]/page.tsx
  - src/app/(dashboard)/[teamSlug]/regattas/[id]/regatta-detail-client.tsx
  - src/app/(dashboard)/[teamSlug]/regattas/new/page.tsx
autonomous: true

must_haves:
  truths:
    - "Coach can view timeline of team's races"
    - "Timeline shows race time, event name, and lineup summary"
    - "Times displayed in venue timezone"
    - "Coach can create manual regatta via form"
  artifacts:
    - path: "src/components/regatta/race-timeline.tsx"
      provides: "Timeline component for race schedule"
      exports: ["RaceTimeline"]
    - path: "src/components/regatta/entry-card.tsx"
      provides: "Entry card for timeline items"
      exports: ["EntryCard"]
    - path: "src/app/(dashboard)/[teamSlug]/regattas/[id]/page.tsx"
      provides: "Regatta detail page with timeline"
      min_lines: 30
  key_links:
    - from: "RaceTimeline"
      to: "formatInTimeZone"
      via: "date-fns-tz for venue timezone"
      pattern: "formatInTimeZone.*timezone"
    - from: "regatta-detail-client.tsx"
      to: "/api/regattas/[id]"
      via: "fetch regatta with entries"
      pattern: "fetch.*api/regattas"
---

<objective>
Build timeline view UI for regatta race schedules with venue timezone support.

Purpose: Enables REG-03 (build timeline view) showing race schedule in chronological order.
Output: Timeline component, regatta list page, regatta detail page with entry management.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-regatta-mode/05-RESEARCH.md

# Prior plan outputs
@.planning/phases/05-regatta-mode/05-02-SUMMARY.md
@.planning/phases/05-regatta-mode/05-04-SUMMARY.md

# Existing UI patterns
@src/app/(dashboard)/[teamSlug]/practices/page.tsx
@src/app/(dashboard)/[teamSlug]/practices/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install date-fns-tz and create timeline components</name>
  <files>src/components/regatta/race-timeline.tsx, src/components/regatta/entry-card.tsx</files>
  <action>
1. Install date-fns-tz:
```bash
npm install date-fns-tz
```

2. Create src/components/regatta/entry-card.tsx:

```typescript
'use client';

import { formatInTimeZone } from 'date-fns-tz';
import { Clock, MapPin, Users, AlertCircle } from 'lucide-react';

interface EntryCardProps {
  entry: {
    id: string;
    eventName: string;
    scheduledTime: string;
    meetingLocation?: string | null;
    meetingTime?: string | null;
    notes?: string | null;
    status: 'SCHEDULED' | 'SCRATCHED' | 'COMPLETED';
    heat?: string | null;
    lane?: number | null;
    placement?: number | null;
    entryLineup?: {
      boat?: { id: string; name: string } | null;
      seats: { position: number; athlete: { id: string; displayName: string | null } }[];
    } | null;
    notificationConfig?: {
      leadTimeMinutes: number;
      notificationSent: boolean;
    } | null;
  };
  timezone: string;
  isNext?: boolean;
  onClick?: () => void;
}

export function EntryCard({ entry, timezone, isNext, onClick }: EntryCardProps) {
  const timeStr = formatInTimeZone(
    new Date(entry.scheduledTime),
    timezone,
    'h:mm a'
  );

  const statusColors = {
    SCHEDULED: isNext ? 'border-blue-500 bg-blue-50' : 'border-gray-200 bg-white',
    SCRATCHED: 'border-gray-300 bg-gray-100 opacity-60',
    COMPLETED: 'border-green-500 bg-green-50',
  };

  const lineupSummary = entry.entryLineup?.seats
    ?.map((s) => s.athlete.displayName || 'Unknown')
    .join(', ');

  return (
    <div
      onClick={onClick}
      className={`border-l-4 rounded-r-lg p-4 shadow-sm cursor-pointer hover:shadow-md transition-shadow ${statusColors[entry.status]}`}
    >
      <div className="flex justify-between items-start">
        <div className="flex-1">
          <div className="flex items-center gap-2">
            <span className="text-lg font-semibold">{timeStr}</span>
            {entry.heat && (
              <span className="text-sm text-gray-500">- {entry.heat}</span>
            )}
            {entry.lane && (
              <span className="text-sm bg-gray-100 px-2 py-0.5 rounded">
                Lane {entry.lane}
              </span>
            )}
          </div>

          <h3
            className={`text-base font-medium mt-1 ${
              entry.status === 'SCRATCHED' ? 'line-through text-gray-400' : ''
            }`}
          >
            {entry.eventName}
          </h3>

          {entry.meetingLocation && (
            <div className="flex items-center gap-1 text-sm text-gray-600 mt-2">
              <MapPin className="h-4 w-4" />
              <span>Meet: {entry.meetingLocation}</span>
              {entry.meetingTime && (
                <span className="ml-2">
                  at {formatInTimeZone(new Date(entry.meetingTime), timezone, 'h:mm a')}
                </span>
              )}
            </div>
          )}

          {entry.entryLineup && (
            <div className="flex items-center gap-1 text-sm text-gray-600 mt-1">
              <Users className="h-4 w-4" />
              <span>
                {entry.entryLineup.boat?.name || 'No boat'}
                {lineupSummary && `: ${lineupSummary}`}
              </span>
            </div>
          )}

          {entry.notes && (
            <p className="text-sm text-gray-500 mt-2 italic">{entry.notes}</p>
          )}
        </div>

        <div className="flex flex-col items-end gap-1">
          {entry.status === 'COMPLETED' && entry.placement && (
            <span className="text-lg font-bold text-green-600">
              #{entry.placement}
            </span>
          )}

          {entry.notificationConfig && !entry.notificationConfig.notificationSent && (
            <div className="flex items-center gap-1 text-xs text-blue-600">
              <Clock className="h-3 w-3" />
              <span>{entry.notificationConfig.leadTimeMinutes}min</span>
            </div>
          )}

          {!entry.entryLineup && entry.status === 'SCHEDULED' && (
            <div className="flex items-center gap-1 text-xs text-amber-600">
              <AlertCircle className="h-3 w-3" />
              <span>No lineup</span>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
```

3. Create src/components/regatta/race-timeline.tsx:

```typescript
'use client';

import { formatInTimeZone } from 'date-fns-tz';
import { format, isSameDay, parseISO } from 'date-fns';
import { EntryCard } from './entry-card';

interface Entry {
  id: string;
  eventName: string;
  scheduledTime: string;
  meetingLocation?: string | null;
  meetingTime?: string | null;
  notes?: string | null;
  status: 'SCHEDULED' | 'SCRATCHED' | 'COMPLETED';
  heat?: string | null;
  lane?: number | null;
  placement?: number | null;
  entryLineup?: {
    boat?: { id: string; name: string } | null;
    seats: { position: number; athlete: { id: string; displayName: string | null } }[];
  } | null;
  notificationConfig?: {
    leadTimeMinutes: number;
    notificationSent: boolean;
  } | null;
}

interface RaceTimelineProps {
  entries: Entry[];
  timezone: string;
  onEntryClick?: (entry: Entry) => void;
}

export function RaceTimeline({ entries, timezone, onEntryClick }: RaceTimelineProps) {
  // Sort by scheduled time
  const sortedEntries = [...entries].sort(
    (a, b) => new Date(a.scheduledTime).getTime() - new Date(b.scheduledTime).getTime()
  );

  // Group by date
  const groupedByDate = sortedEntries.reduce((acc, entry) => {
    const date = format(parseISO(entry.scheduledTime), 'yyyy-MM-dd');
    if (!acc[date]) acc[date] = [];
    acc[date].push(entry);
    return acc;
  }, {} as Record<string, Entry[]>);

  // Find the next upcoming entry
  const now = new Date();
  const nextEntry = sortedEntries.find(
    (e) => e.status === 'SCHEDULED' && new Date(e.scheduledTime) > now
  );

  if (entries.length === 0) {
    return (
      <div className="text-center py-12 text-gray-500">
        <p>No entries scheduled</p>
        <p className="text-sm mt-2">Add entries to see the race timeline</p>
      </div>
    );
  }

  return (
    <div className="space-y-8">
      {Object.entries(groupedByDate).map(([date, dayEntries]) => (
        <div key={date}>
          {/* Date header */}
          <div className="sticky top-0 bg-white z-10 py-2 border-b mb-4">
            <h3 className="text-lg font-semibold text-gray-700">
              {format(parseISO(date), 'EEEE, MMMM d, yyyy')}
            </h3>
            <p className="text-sm text-gray-500">
              Times shown in {timezone}
            </p>
          </div>

          {/* Entries for this date */}
          <div className="space-y-3">
            {dayEntries.map((entry) => (
              <EntryCard
                key={entry.id}
                entry={entry}
                timezone={timezone}
                isNext={entry.id === nextEntry?.id}
                onClick={() => onEntryClick?.(entry)}
              />
            ))}
          </div>
        </div>
      ))}
    </div>
  );
}
```
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>Timeline components created with venue timezone support</done>
</task>

<task type="auto">
  <name>Task 2: Create regatta list and create pages</name>
  <files>src/app/(dashboard)/[teamSlug]/regattas/page.tsx, src/app/(dashboard)/[teamSlug]/regattas/new/page.tsx</files>
  <action>
1. Create src/app/(dashboard)/[teamSlug]/regattas/page.tsx:

```typescript
import { Metadata } from 'next';
import { redirect } from 'next/navigation';
import Link from 'next/link';
import { prisma } from '@/lib/prisma';
import { getTeamForUser } from '@/lib/team';
import { format } from 'date-fns';
import { Calendar, MapPin, Plus, ChevronRight } from 'lucide-react';

export const metadata: Metadata = {
  title: 'Regattas | RowOps',
};

interface PageProps {
  params: Promise<{ teamSlug: string }>;
  searchParams: Promise<{ seasonId?: string }>;
}

export default async function RegattasPage({ params, searchParams }: PageProps) {
  const { teamSlug } = await params;
  const { seasonId } = await searchParams;

  const team = await getTeamForUser(teamSlug);
  if (!team) redirect('/');

  // Get active seasons for filter
  const seasons = await prisma.season.findMany({
    where: { teamId: team.id, status: 'ACTIVE' },
    orderBy: { startDate: 'desc' },
  });

  // Get regattas
  const where: Record<string, unknown> = { teamId: team.id };
  if (seasonId) {
    where.seasonId = seasonId;
  }

  const regattas = await prisma.regatta.findMany({
    where,
    include: {
      season: { select: { id: true, name: true } },
      _count: { select: { entries: true } },
    },
    orderBy: { startDate: 'desc' },
  });

  // Split into upcoming and past
  const now = new Date();
  const upcomingRegattas = regattas.filter((r) => r.startDate >= now);
  const pastRegattas = regattas.filter((r) => r.startDate < now);

  return (
    <div className="max-w-4xl mx-auto px-4 py-8">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-2xl font-bold">Regattas</h1>
        <Link
          href={`/${teamSlug}/regattas/new`}
          className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          <Plus className="h-5 w-5" />
          Add Regatta
        </Link>
      </div>

      {/* Season filter */}
      {seasons.length > 1 && (
        <div className="mb-6">
          <label className="text-sm text-gray-600 mr-2">Season:</label>
          <select
            className="border rounded-lg px-3 py-1.5"
            defaultValue={seasonId || ''}
            onChange={(e) => {
              const url = new URL(window.location.href);
              if (e.target.value) {
                url.searchParams.set('seasonId', e.target.value);
              } else {
                url.searchParams.delete('seasonId');
              }
              window.location.href = url.toString();
            }}
          >
            <option value="">All Seasons</option>
            {seasons.map((s) => (
              <option key={s.id} value={s.id}>
                {s.name}
              </option>
            ))}
          </select>
        </div>
      )}

      {/* Upcoming regattas */}
      {upcomingRegattas.length > 0 && (
        <section className="mb-8">
          <h2 className="text-lg font-semibold mb-4 text-gray-700">Upcoming</h2>
          <div className="space-y-3">
            {upcomingRegattas.map((regatta) => (
              <Link
                key={regatta.id}
                href={`/${teamSlug}/regattas/${regatta.id}`}
                className="block bg-white border rounded-lg p-4 hover:shadow-md transition-shadow"
              >
                <div className="flex justify-between items-start">
                  <div>
                    <h3 className="font-medium text-lg">{regatta.name}</h3>
                    <div className="flex items-center gap-4 mt-2 text-sm text-gray-600">
                      <span className="flex items-center gap-1">
                        <Calendar className="h-4 w-4" />
                        {format(regatta.startDate, 'MMM d, yyyy')}
                        {regatta.endDate &&
                          !isSameDay(regatta.startDate, regatta.endDate) &&
                          ` - ${format(regatta.endDate, 'MMM d')}`}
                      </span>
                      {regatta.location && (
                        <span className="flex items-center gap-1">
                          <MapPin className="h-4 w-4" />
                          {regatta.location}
                        </span>
                      )}
                    </div>
                  </div>
                  <div className="flex items-center gap-2 text-gray-500">
                    <span className="text-sm">{regatta._count.entries} entries</span>
                    <ChevronRight className="h-5 w-5" />
                  </div>
                </div>
              </Link>
            ))}
          </div>
        </section>
      )}

      {/* Past regattas */}
      {pastRegattas.length > 0 && (
        <section>
          <h2 className="text-lg font-semibold mb-4 text-gray-500">Past</h2>
          <div className="space-y-3 opacity-75">
            {pastRegattas.map((regatta) => (
              <Link
                key={regatta.id}
                href={`/${teamSlug}/regattas/${regatta.id}`}
                className="block bg-white border rounded-lg p-4 hover:shadow-sm transition-shadow"
              >
                <div className="flex justify-between items-center">
                  <div>
                    <h3 className="font-medium">{regatta.name}</h3>
                    <div className="flex items-center gap-4 mt-1 text-sm text-gray-500">
                      <span>{format(regatta.startDate, 'MMM d, yyyy')}</span>
                      {regatta.location && <span>{regatta.location}</span>}
                    </div>
                  </div>
                  <span className="text-sm text-gray-400">{regatta._count.entries} entries</span>
                </div>
              </Link>
            ))}
          </div>
        </section>
      )}

      {regattas.length === 0 && (
        <div className="text-center py-12 text-gray-500">
          <p>No regattas yet</p>
          <p className="text-sm mt-2">Create a regatta or import from Regatta Central</p>
        </div>
      )}
    </div>
  );
}

function isSameDay(date1: Date, date2: Date): boolean {
  return (
    date1.getFullYear() === date2.getFullYear() &&
    date1.getMonth() === date2.getMonth() &&
    date1.getDate() === date2.getDate()
  );
}
```

2. Create src/app/(dashboard)/[teamSlug]/regattas/new/page.tsx:

```typescript
import { Metadata } from 'next';
import { redirect } from 'next/navigation';
import Link from 'next/link';
import { prisma } from '@/lib/prisma';
import { getTeamForUser } from '@/lib/team';
import { RegattaForm } from '@/components/regatta/regatta-form';
import { ArrowLeft } from 'lucide-react';

export const metadata: Metadata = {
  title: 'New Regatta | RowOps',
};

interface PageProps {
  params: Promise<{ teamSlug: string }>;
}

export default async function NewRegattaPage({ params }: PageProps) {
  const { teamSlug } = await params;

  const team = await getTeamForUser(teamSlug);
  if (!team) redirect('/');

  // Get active seasons for dropdown
  const seasons = await prisma.season.findMany({
    where: { teamId: team.id, status: 'ACTIVE' },
    orderBy: { startDate: 'desc' },
  });

  if (seasons.length === 0) {
    return (
      <div className="max-w-2xl mx-auto px-4 py-8">
        <div className="text-center py-12">
          <p className="text-gray-600">No active seasons found.</p>
          <p className="text-sm text-gray-500 mt-2">
            Create a season first before adding regattas.
          </p>
          <Link
            href={`/${teamSlug}/settings/seasons`}
            className="inline-block mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            Manage Seasons
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="max-w-2xl mx-auto px-4 py-8">
      <Link
        href={`/${teamSlug}/regattas`}
        className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6"
      >
        <ArrowLeft className="h-4 w-4" />
        Back to Regattas
      </Link>

      <h1 className="text-2xl font-bold mb-6">New Regatta</h1>

      <RegattaForm
        teamSlug={teamSlug}
        seasons={seasons.map((s) => ({ id: s.id, name: s.name }))}
        defaultSeasonId={seasons[0]?.id}
      />
    </div>
  );
}
```

3. Create src/components/regatta/regatta-form.tsx:

```typescript
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';

interface RegattaFormProps {
  teamSlug: string;
  seasons: { id: string; name: string }[];
  defaultSeasonId?: string;
  regatta?: {
    id: string;
    name: string;
    location?: string | null;
    venue?: string | null;
    timezone?: string | null;
    startDate: string;
    endDate?: string | null;
    seasonId: string;
  };
}

const COMMON_TIMEZONES = [
  'America/New_York',
  'America/Chicago',
  'America/Denver',
  'America/Los_Angeles',
  'America/Phoenix',
  'Europe/London',
  'Europe/Paris',
  'Australia/Sydney',
];

export function RegattaForm({ teamSlug, seasons, defaultSeasonId, regatta }: RegattaFormProps) {
  const router = useRouter();
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const isEdit = !!regatta;

  async function handleSubmit(e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();
    setIsSubmitting(true);
    setError(null);

    const formData = new FormData(e.currentTarget);
    const data = {
      seasonId: formData.get('seasonId') as string,
      name: formData.get('name') as string,
      location: formData.get('location') as string || undefined,
      venue: formData.get('venue') as string || undefined,
      timezone: formData.get('timezone') as string || undefined,
      startDate: new Date(formData.get('startDate') as string).toISOString(),
      endDate: formData.get('endDate')
        ? new Date(formData.get('endDate') as string).toISOString()
        : undefined,
    };

    try {
      const url = isEdit
        ? `/api/regattas/${regatta.id}`
        : '/api/regattas';
      const method = isEdit ? 'PATCH' : 'POST';

      const response = await fetch(url, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      if (!response.ok) {
        const err = await response.json();
        throw new Error(err.error || 'Failed to save regatta');
      }

      const result = await response.json();
      router.push(`/${teamSlug}/regattas/${result.regatta.id}`);
      router.refresh();
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred');
    } finally {
      setIsSubmitting(false);
    }
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      {error && (
        <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
          {error}
        </div>
      )}

      <div>
        <label htmlFor="seasonId" className="block text-sm font-medium text-gray-700 mb-1">
          Season *
        </label>
        <select
          id="seasonId"
          name="seasonId"
          required
          defaultValue={regatta?.seasonId || defaultSeasonId}
          className="w-full border rounded-lg px-3 py-2"
        >
          {seasons.map((s) => (
            <option key={s.id} value={s.id}>
              {s.name}
            </option>
          ))}
        </select>
      </div>

      <div>
        <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-1">
          Regatta Name *
        </label>
        <input
          type="text"
          id="name"
          name="name"
          required
          maxLength={200}
          defaultValue={regatta?.name}
          placeholder="e.g., Head of the Charles"
          className="w-full border rounded-lg px-3 py-2"
        />
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div>
          <label htmlFor="location" className="block text-sm font-medium text-gray-700 mb-1">
            Location
          </label>
          <input
            type="text"
            id="location"
            name="location"
            maxLength={200}
            defaultValue={regatta?.location || ''}
            placeholder="e.g., Boston, MA"
            className="w-full border rounded-lg px-3 py-2"
          />
        </div>

        <div>
          <label htmlFor="venue" className="block text-sm font-medium text-gray-700 mb-1">
            Venue
          </label>
          <input
            type="text"
            id="venue"
            name="venue"
            maxLength={200}
            defaultValue={regatta?.venue || ''}
            placeholder="e.g., Charles River"
            className="w-full border rounded-lg px-3 py-2"
          />
        </div>
      </div>

      <div>
        <label htmlFor="timezone" className="block text-sm font-medium text-gray-700 mb-1">
          Timezone
        </label>
        <select
          id="timezone"
          name="timezone"
          defaultValue={regatta?.timezone || ''}
          className="w-full border rounded-lg px-3 py-2"
        >
          <option value="">Select timezone...</option>
          {COMMON_TIMEZONES.map((tz) => (
            <option key={tz} value={tz}>
              {tz.replace('_', ' ')}
            </option>
          ))}
        </select>
        <p className="text-xs text-gray-500 mt-1">Times will be displayed in this timezone</p>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div>
          <label htmlFor="startDate" className="block text-sm font-medium text-gray-700 mb-1">
            Start Date *
          </label>
          <input
            type="date"
            id="startDate"
            name="startDate"
            required
            defaultValue={regatta?.startDate?.slice(0, 10)}
            className="w-full border rounded-lg px-3 py-2"
          />
        </div>

        <div>
          <label htmlFor="endDate" className="block text-sm font-medium text-gray-700 mb-1">
            End Date
          </label>
          <input
            type="date"
            id="endDate"
            name="endDate"
            defaultValue={regatta?.endDate?.slice(0, 10) || ''}
            className="w-full border rounded-lg px-3 py-2"
          />
        </div>
      </div>

      <div className="flex gap-4">
        <button
          type="submit"
          disabled={isSubmitting}
          className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
        >
          {isSubmitting ? 'Saving...' : isEdit ? 'Save Changes' : 'Create Regatta'}
        </button>
        <button
          type="button"
          onClick={() => router.back()}
          className="px-4 py-2 border rounded-lg hover:bg-gray-50"
        >
          Cancel
        </button>
      </div>
    </form>
  );
}
```
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>Regatta list, create pages, and form component created</done>
</task>

<task type="auto">
  <name>Task 3: Create regatta detail page with timeline</name>
  <files>src/app/(dashboard)/[teamSlug]/regattas/[id]/page.tsx, src/app/(dashboard)/[teamSlug]/regattas/[id]/regatta-detail-client.tsx</files>
  <action>
1. Create src/app/(dashboard)/[teamSlug]/regattas/[id]/page.tsx:

```typescript
import { Metadata } from 'next';
import { redirect, notFound } from 'next/navigation';
import Link from 'next/link';
import { prisma } from '@/lib/prisma';
import { getTeamForUser } from '@/lib/team';
import { format } from 'date-fns';
import { ArrowLeft, Calendar, MapPin, Clock, RefreshCw } from 'lucide-react';
import { RegattaDetailClient } from './regatta-detail-client';

export async function generateMetadata({ params }: PageProps): Promise<Metadata> {
  const { id } = await params;
  const regatta = await prisma.regatta.findUnique({
    where: { id },
    select: { name: true },
  });
  return { title: regatta ? `${regatta.name} | RowOps` : 'Regatta | RowOps' };
}

interface PageProps {
  params: Promise<{ teamSlug: string; id: string }>;
}

export default async function RegattaDetailPage({ params }: PageProps) {
  const { teamSlug, id } = await params;

  const team = await getTeamForUser(teamSlug);
  if (!team) redirect('/');

  const regatta = await prisma.regatta.findFirst({
    where: { id, teamId: team.id },
    include: {
      season: { select: { id: true, name: true } },
      entries: {
        include: {
          entryLineup: {
            include: {
              boat: { select: { id: true, name: true, boatClass: true } },
              seats: {
                include: {
                  athlete: { select: { id: true, displayName: true } },
                },
                orderBy: { position: 'asc' },
              },
            },
          },
          notificationConfig: {
            select: { leadTimeMinutes: true, notificationSent: true },
          },
        },
        orderBy: { scheduledTime: 'asc' },
      },
    },
  });

  if (!regatta) notFound();

  // Get team athletes for lineup assignment
  const athletes = await prisma.athleteProfile.findMany({
    where: {
      teamMember: { teamId: team.id },
    },
    select: {
      id: true,
      displayName: true,
      sidePreference: true,
      canBow: true,
      canCox: true,
    },
    orderBy: { displayName: 'asc' },
  });

  // Get available boats
  const boats = await prisma.equipment.findMany({
    where: {
      teamId: team.id,
      type: 'SHELL',
      status: 'ACTIVE',
    },
    select: {
      id: true,
      name: true,
      boatClass: true,
    },
    orderBy: { name: 'asc' },
  });

  const timezone = regatta.timezone || 'America/New_York';

  return (
    <div className="max-w-4xl mx-auto px-4 py-8">
      <Link
        href={`/${teamSlug}/regattas`}
        className="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6"
      >
        <ArrowLeft className="h-4 w-4" />
        Back to Regattas
      </Link>

      {/* Header */}
      <div className="bg-white border rounded-lg p-6 mb-6">
        <div className="flex justify-between items-start">
          <div>
            <h1 className="text-2xl font-bold">{regatta.name}</h1>
            <div className="flex flex-wrap items-center gap-4 mt-3 text-sm text-gray-600">
              <span className="flex items-center gap-1">
                <Calendar className="h-4 w-4" />
                {format(regatta.startDate, 'MMMM d, yyyy')}
                {regatta.endDate && ` - ${format(regatta.endDate, 'MMMM d, yyyy')}`}
              </span>
              {regatta.location && (
                <span className="flex items-center gap-1">
                  <MapPin className="h-4 w-4" />
                  {regatta.location}
                  {regatta.venue && ` - ${regatta.venue}`}
                </span>
              )}
              <span className="flex items-center gap-1">
                <Clock className="h-4 w-4" />
                {timezone}
              </span>
            </div>
          </div>

          {regatta.source === 'REGATTA_CENTRAL' && regatta.lastSyncAt && (
            <div className="text-right text-sm text-gray-500">
              <div className="flex items-center gap-1">
                <RefreshCw className="h-4 w-4" />
                <span>Last synced: {format(regatta.lastSyncAt, 'MMM d, h:mm a')}</span>
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Client component for interactive features */}
      <RegattaDetailClient
        teamSlug={teamSlug}
        regatta={{
          id: regatta.id,
          name: regatta.name,
          timezone,
          source: regatta.source,
          entries: regatta.entries.map((e) => ({
            id: e.id,
            eventName: e.eventName,
            scheduledTime: e.scheduledTime.toISOString(),
            meetingLocation: e.meetingLocation,
            meetingTime: e.meetingTime?.toISOString(),
            notes: e.notes,
            status: e.status,
            heat: e.heat,
            lane: e.lane,
            placement: e.placement,
            entryLineup: e.entryLineup
              ? {
                  boat: e.entryLineup.boat,
                  seats: e.entryLineup.seats.map((s) => ({
                    position: s.position,
                    athlete: { id: s.athlete.id, displayName: s.athlete.displayName },
                  })),
                }
              : null,
            notificationConfig: e.notificationConfig,
          })),
        }}
        athletes={athletes}
        boats={boats}
      />
    </div>
  );
}
```

2. Create src/app/(dashboard)/[teamSlug]/regattas/[id]/regatta-detail-client.tsx:

```typescript
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { RaceTimeline } from '@/components/regatta/race-timeline';
import { Plus, Settings } from 'lucide-react';

interface Entry {
  id: string;
  eventName: string;
  scheduledTime: string;
  meetingLocation?: string | null;
  meetingTime?: string | null;
  notes?: string | null;
  status: 'SCHEDULED' | 'SCRATCHED' | 'COMPLETED';
  heat?: string | null;
  lane?: number | null;
  placement?: number | null;
  entryLineup?: {
    boat?: { id: string; name: string } | null;
    seats: { position: number; athlete: { id: string; displayName: string | null } }[];
  } | null;
  notificationConfig?: {
    leadTimeMinutes: number;
    notificationSent: boolean;
  } | null;
}

interface RegattaDetailClientProps {
  teamSlug: string;
  regatta: {
    id: string;
    name: string;
    timezone: string;
    source: string;
    entries: Entry[];
  };
  athletes: { id: string; displayName: string | null; sidePreference?: string | null; canBow: boolean; canCox: boolean }[];
  boats: { id: string; name: string; boatClass: string | null }[];
}

export function RegattaDetailClient({
  teamSlug,
  regatta,
  athletes,
  boats,
}: RegattaDetailClientProps) {
  const router = useRouter();
  const [selectedEntry, setSelectedEntry] = useState<Entry | null>(null);

  function handleEntryClick(entry: Entry) {
    setSelectedEntry(entry);
    // For now, just navigate to entry page (will be built in later plan)
    router.push(`/${teamSlug}/regattas/${regatta.id}/entries/${entry.id}`);
  }

  return (
    <div>
      {/* Actions bar */}
      <div className="flex justify-between items-center mb-6">
        <h2 className="text-lg font-semibold">Race Schedule</h2>
        <div className="flex gap-2">
          <button
            onClick={() => router.push(`/${teamSlug}/regattas/${regatta.id}/entries/new`)}
            className="flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm"
          >
            <Plus className="h-4 w-4" />
            Add Entry
          </button>
          <button
            onClick={() => router.push(`/${teamSlug}/regattas/${regatta.id}/settings`)}
            className="flex items-center gap-2 px-3 py-1.5 border rounded-lg hover:bg-gray-50 text-sm"
          >
            <Settings className="h-4 w-4" />
            Settings
          </button>
        </div>
      </div>

      {/* Timeline */}
      <RaceTimeline
        entries={regatta.entries}
        timezone={regatta.timezone}
        onEntryClick={handleEntryClick}
      />
    </div>
  );
}
```
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>Regatta detail page with timeline view created</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. /[teamSlug]/regattas page shows upcoming and past regattas
3. /[teamSlug]/regattas/new allows creating manual regatta
4. /[teamSlug]/regattas/[id] shows timeline with entries
5. Times are displayed in venue timezone
</verification>

<success_criteria>
- Regatta list page shows regattas grouped by upcoming/past
- Create regatta form includes timezone selection
- Regatta detail shows RaceTimeline component
- Timeline displays entries chronologically by date
- Times displayed in venue timezone with date-fns-tz
- Entry cards show meeting location, lineup summary, notification status
- "Next" entry highlighted in timeline
- REG-03 requirement satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/05-regatta-mode/05-05-SUMMARY.md`
</output>
