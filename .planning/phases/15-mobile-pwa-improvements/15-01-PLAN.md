---
phase: 15-mobile-pwa-improvements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/ui/drawer.tsx
  - next.config.ts
autonomous: true

must_haves:
  truths:
    - "@use-gesture/react and vaul packages are installed"
    - "shadcn/ui Drawer component is available for mobile bottom sheets"
    - "View transitions are enabled in Next.js config"
  artifacts:
    - path: "package.json"
      provides: "New dependencies"
      contains: "@use-gesture/react"
    - path: "src/components/ui/drawer.tsx"
      provides: "shadcn Drawer component built on Vaul"
      exports: ["Drawer", "DrawerContent", "DrawerTrigger"]
    - path: "next.config.ts"
      provides: "View transition configuration"
      contains: "viewTransition"
  key_links:
    - from: "src/components/ui/drawer.tsx"
      to: "vaul"
      via: "import from vaul"
      pattern: "from ['\"]vaul['\"]"
---

<objective>
Install core dependencies and configure Next.js for mobile PWA improvements.

Purpose: Establish the foundation libraries (gesture handling, bottom sheets, view transitions) that all other mobile features will build upon.
Output: Installed packages, shadcn Drawer component, view transitions enabled in Next.js config.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/15-mobile-pwa-improvements/15-CONTEXT.md
@.planning/phases/15-mobile-pwa-improvements/15-RESEARCH.md
@src/components/ui/button.tsx (for shadcn component pattern reference)
@next.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install gesture and drawer dependencies</name>
  <files>package.json</files>
  <action>
    Install the required packages for mobile PWA features:

    ```bash
    npm install @use-gesture/react vaul
    ```

    Note: @react-spring/web is optional and NOT needed initially. @use-gesture/react works standalone with CSS transforms and requestAnimationFrame. Only add react-spring later if smoother animations are needed.

    Verify packages are added to dependencies (not devDependencies).
  </action>
  <verify>`npm ls @use-gesture/react vaul` shows both packages installed</verify>
  <done>@use-gesture/react and vaul are in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Add shadcn Drawer component</name>
  <files>src/components/ui/drawer.tsx</files>
  <action>
    Create the shadcn/ui Drawer component built on Vaul. This component provides bottom sheet functionality for mobile.

    The component should:
    1. Re-export Vaul's Drawer primitives with shadcn styling
    2. Include DrawerOverlay with dark backdrop (bg-black/80)
    3. Include DrawerContent with:
       - Fixed position at bottom
       - Rounded top corners
       - Theme-matched background (use bg-background from shadcn)
       - Drag handle at top (subtle gray bar)
    4. Export: Drawer, DrawerPortal, DrawerOverlay, DrawerTrigger, DrawerClose, DrawerContent, DrawerHeader, DrawerFooter, DrawerTitle, DrawerDescription

    Follow the existing shadcn component patterns in src/components/ui/button.tsx:
    - Use 'use client' directive
    - Use cn() for class merging
    - Use forwardRef for all content components

    Style the drag handle to match existing theme:
    - Use bg-muted (maps to --surface-3 which is zinc-700)
    - Centered, w-[100px], h-2, rounded-full, mt-4

    Use z-index 50 for overlay and content (consistent with dialog.tsx).
  </action>
  <verify>File exists at src/components/ui/drawer.tsx with all exports</verify>
  <done>Drawer component exports Drawer, DrawerContent, DrawerTrigger and follows shadcn patterns</done>
</task>

<task type="auto">
  <name>Task 3: Enable view transitions in Next.js config</name>
  <files>next.config.ts</files>
  <action>
    Add the experimental viewTransition option to next.config.ts.

    Update the nextConfig object:
    ```typescript
    const nextConfig: NextConfig = {
      experimental: {
        viewTransition: true,
      },
    };
    ```

    This enables the View Transitions API for smooth page transitions. The browser will automatically apply cross-fade animations between page navigations.

    Important: Keep the existing Serwist configuration unchanged. The config should still use withSerwist wrapper.
  </action>
  <verify>`cat next.config.ts` shows viewTransition: true in experimental</verify>
  <done>Next.js config has experimental.viewTransition enabled while preserving Serwist setup</done>
</task>

</tasks>

<verification>
1. `npm ls @use-gesture/react vaul` shows both packages
2. `cat src/components/ui/drawer.tsx` shows Drawer component with Vaul imports
3. `cat next.config.ts` shows viewTransition: true in experimental block
4. `npm run build` completes without errors (validates TypeScript compilation)
</verification>

<success_criteria>
- @use-gesture/react and vaul installed in package.json
- Drawer component created following shadcn patterns
- View transitions enabled in Next.js config
- Build passes without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-mobile-pwa-improvements/15-01-SUMMARY.md`
</output>
