---
phase: 15-mobile-pwa-improvements
plan: 04
type: execute
wave: 2
depends_on: ["15-01"]
files_modified:
  - src/hooks/use-media-query.ts
  - src/components/mobile/responsive-menu.tsx
autonomous: true

must_haves:
  truths:
    - "Menu shows as dropdown on desktop (>= 768px)"
    - "Menu shows as bottom sheet on mobile (< 768px)"
    - "Bottom sheet has drag handle and swipe-to-dismiss"
    - "Both variants support same menu item content"
  artifacts:
    - path: "src/hooks/use-media-query.ts"
      provides: "Hook for responsive breakpoint detection"
      exports: ["useMediaQuery"]
    - path: "src/components/mobile/responsive-menu.tsx"
      provides: "Menu component that adapts to screen size"
      exports: ["ResponsiveMenu", "ResponsiveMenuItem"]
  key_links:
    - from: "src/components/mobile/responsive-menu.tsx"
      to: "src/components/ui/drawer.tsx"
      via: "import Drawer for mobile"
      pattern: "from ['\"]@/components/ui/drawer['\"]"
    - from: "src/components/mobile/responsive-menu.tsx"
      to: "src/components/ui/dropdown-menu.tsx"
      via: "import DropdownMenu for desktop"
      pattern: "from ['\"]@/components/ui/dropdown-menu['\"]"
---

<objective>
Create a responsive menu system that uses dropdowns on desktop and bottom sheets on mobile.

Purpose: Mobile users expect bottom sheets for contextual actions (more thumb-friendly than dropdowns), while desktop users prefer traditional dropdown menus. This component automatically adapts based on viewport.
Output: useMediaQuery hook and ResponsiveMenu component that switches between Drawer and DropdownMenu.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/15-mobile-pwa-improvements/15-CONTEXT.md
@.planning/phases/15-mobile-pwa-improvements/15-RESEARCH.md
@src/components/ui/dropdown-menu.tsx
@src/components/ui/drawer.tsx (created in 15-01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useMediaQuery hook</name>
  <files>src/hooks/use-media-query.ts</files>
  <action>
    Create a reusable hook for detecting media query matches with SSR support.

    The hook should:
    1. Accept a media query string (e.g., "(max-width: 767px)")
    2. Use window.matchMedia for detection
    3. Handle SSR (return false on server)
    4. Update on viewport resize via matchMedia change listener

    Implementation:
    ```typescript
    'use client';

    import { useState, useEffect } from 'react';

    export function useMediaQuery(query: string): boolean {
      // Default to false for SSR
      const [matches, setMatches] = useState(false);

      useEffect(() => {
        const mediaQuery = window.matchMedia(query);

        // Set initial value
        setMatches(mediaQuery.matches);

        // Create listener
        const handler = (event: MediaQueryListEvent) => {
          setMatches(event.matches);
        };

        // Add listener (use addEventListener for modern browsers)
        mediaQuery.addEventListener('change', handler);

        return () => {
          mediaQuery.removeEventListener('change', handler);
        };
      }, [query]);

      return matches;
    }
    ```

    Also export a convenience hook for mobile detection:
    ```typescript
    export function useIsMobile(): boolean {
      return useMediaQuery('(max-width: 767px)');
    }
    ```

    Export both as named exports.
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>useMediaQuery and useIsMobile hooks exist and handle SSR correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create ResponsiveMenu component</name>
  <files>src/components/mobile/responsive-menu.tsx</files>
  <action>
    Create a menu component that renders as DropdownMenu on desktop and Drawer (bottom sheet) on mobile.

    Props interface:
    ```typescript
    interface ResponsiveMenuProps {
      trigger: React.ReactNode;  // Button or element that opens menu
      children: React.ReactNode; // Menu items
      align?: 'start' | 'center' | 'end';  // Dropdown alignment (desktop)
      title?: string;  // Optional title for bottom sheet (mobile)
    }

    interface ResponsiveMenuItemProps {
      children: React.ReactNode;
      onSelect?: () => void;
      disabled?: boolean;
      destructive?: boolean;  // Red styling for delete actions
      icon?: React.ReactNode;
      className?: string;
    }
    ```

    Component structure:
    ```tsx
    export function ResponsiveMenu({ trigger, children, align = 'end', title }: ResponsiveMenuProps) {
      const isMobile = useIsMobile();

      if (isMobile) {
        return (
          <Drawer>
            <DrawerTrigger asChild>{trigger}</DrawerTrigger>
            <DrawerContent>
              {title && <DrawerHeader><DrawerTitle>{title}</DrawerTitle></DrawerHeader>}
              <div className="p-4 space-y-1">
                {children}
              </div>
            </DrawerContent>
          </Drawer>
        );
      }

      return (
        <DropdownMenu>
          <DropdownMenuTrigger asChild>{trigger}</DropdownMenuTrigger>
          <DropdownMenuContent align={align}>
            {children}
          </DropdownMenuContent>
        </DropdownMenu>
      );
    }
    ```

    ResponsiveMenuItem component:
    - On mobile: Full-width button with p-4, text-left, rounded-lg
    - On desktop: Use DropdownMenuItem styling
    - Destructive variant: text-red-500 styling
    - Icon + text layout with gap-3

    The component should detect which context it's in (Drawer vs DropdownMenu) and render appropriately. Use a context or check parent to determine mode, or export separate MenuItemMobile and MenuItemDesktop that ResponsiveMenuItem can delegate to.

    Simpler approach: ResponsiveMenuItem can be a single component that works in both contexts:
    - When in Drawer: renders as button with mobile-friendly sizing (min-h-[44px] for touch)
    - When in DropdownMenu: renders as DropdownMenuItem

    Use a ResponsiveMenuContext to pass down the mode ('mobile' | 'desktop').

    Bottom sheet style (from CONTEXT.md Decision 6):
    - Use --surface-2 background (already handled by Drawer component)
    - Standard border radius from theme
    - Drag handle at top (built into Drawer)
    - Dismiss via: tap backdrop or swipe down (built into Vaul)

    Export: ResponsiveMenu, ResponsiveMenuItem
  </action>
  <verify>Component renders correctly on both mobile and desktop viewports</verify>
  <done>ResponsiveMenu shows dropdown on desktop and bottom sheet on mobile</done>
</task>

</tasks>

<verification>
1. `cat src/hooks/use-media-query.ts` shows useMediaQuery and useIsMobile hooks
2. `cat src/components/mobile/responsive-menu.tsx` shows ResponsiveMenu component
3. `npm run build` completes without errors
4. Manual test:
   - Desktop viewport: Menu opens as dropdown from trigger
   - Mobile viewport: Menu opens as bottom sheet from bottom of screen
   - Bottom sheet can be dismissed by swiping down or tapping backdrop
</verification>

<success_criteria>
- useMediaQuery hook properly detects viewport changes
- ResponsiveMenu renders DropdownMenu on desktop
- ResponsiveMenu renders Drawer (bottom sheet) on mobile
- Bottom sheet has proper styling matching theme
- Menu items work correctly in both modes
</success_criteria>

<output>
After completion, create `.planning/phases/15-mobile-pwa-improvements/15-04-SUMMARY.md`
</output>
