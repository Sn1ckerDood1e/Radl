---
phase: 24-regatta-central-api
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
  - src/lib/regatta-central/types.ts
  - src/lib/validations/team-settings.ts
autonomous: true

must_haves:
  truths:
    - "TeamSettings can store region filter preferences"
    - "RC regatta response types are defined"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "regattaRegions field on TeamSettings"
      contains: "regattaRegions"
    - path: "src/lib/regatta-central/types.ts"
      provides: "Extended RC types for public regatta display"
      contains: "RCPublicRegatta"
  key_links:
    - from: "prisma/schema.prisma"
      to: "src/lib/validations/team-settings.ts"
      via: "regattaRegions field validation"
      pattern: "regattaRegions"
---

<objective>
Add data foundation for Regatta Central public API integration.

Purpose: Establish schema extensions and type definitions needed for RC regatta fetching and region-based filtering before building the API client and UI.

Output: Updated Prisma schema with regattaRegions field, extended RC types for public regatta data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/intel/summary.md

# Existing infrastructure
@src/lib/regatta-central/types.ts
@prisma/schema.prisma (TeamSettings model)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add regattaRegions field to TeamSettings schema</name>
  <files>prisma/schema.prisma, src/lib/validations/team-settings.ts</files>
  <action>
1. Open prisma/schema.prisma and find the TeamSettings model.

2. Add a new field after the readiness threshold fields:
   ```prisma
   regattaRegions          String[]   @default([])  // RC region codes for regatta filtering (e.g., ["US", "CA"])
   ```

3. Open src/lib/validations/team-settings.ts and add regattaRegions validation.

4. Run `npx prisma db push` to update the database schema.

Note: Region codes follow ISO 3166-1 alpha-2 standard (US, CA, GB, etc.) matching RC API expectations.
  </action>
  <verify>
- `npx prisma db push` completes without errors
- `npx prisma format` shows no formatting issues
- TypeScript compiles with `npx tsc --noEmit`
  </verify>
  <done>TeamSettings model has regattaRegions String[] field with default empty array, validation schema updated</done>
</task>

<task type="auto">
  <name>Task 2: Extend RC types for public regatta display</name>
  <files>src/lib/regatta-central/types.ts</files>
  <action>
1. Open src/lib/regatta-central/types.ts.

2. Add new types for public regatta display (distinct from existing RCRegatta which is for team-specific data):

```typescript
// Public regatta display (extended from API response)
export interface RCPublicRegatta {
  id: string;
  name: string;
  location: string | null;
  venue: string | null;
  startDate: Date;         // Converted from Unix timestamp
  endDate: Date | null;    // Converted from Unix timestamp
  status: RCRegattaStatus;
  registrationStatus: RCRegistrationStatus;
  rcUrl: string;           // Deep link to RC regatta page
  region: string;          // ISO country code
}

// Regatta status from RC API
export type RCRegattaStatus =
  | 'UPCOMING'
  | 'IN_PROGRESS'
  | 'COMPLETED'
  | 'CANCELLED';

// Registration status for display
export type RCRegistrationStatus =
  | 'OPEN'
  | 'CLOSED'
  | 'WAITLIST'
  | 'NOT_AVAILABLE';

// API response for upcoming regattas (server-side transformed)
export interface RCUpcomingRegattasResponse {
  regattas: RCPublicRegatta[];
  cachedAt: string;        // ISO timestamp of when data was cached
  staleAfter: string;      // ISO timestamp when cache becomes stale
}
```

3. Ensure types are exported properly.
  </action>
  <verify>
- TypeScript compiles with `npx tsc --noEmit`
- Types can be imported: `import { RCPublicRegatta } from '@/lib/regatta-central/types'`
  </verify>
  <done>RCPublicRegatta, RCRegattaStatus, RCRegistrationStatus, and RCUpcomingRegattasResponse types defined and exported</done>
</task>

</tasks>

<verification>
1. Schema check: `npx prisma validate` passes
2. Type check: `npx tsc --noEmit` passes
3. Linting: `npm run lint` passes
</verification>

<success_criteria>
- TeamSettings.regattaRegions field exists in Prisma schema
- Validation schema updated for regattaRegions
- RC public regatta types defined with proper status enums
- Database migration applied successfully
- TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/24-regatta-central-api/24-01-SUMMARY.md`
</output>
