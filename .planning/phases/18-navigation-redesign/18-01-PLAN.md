---
phase: 18-navigation-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/navigation-sidebar.tsx
  - src/components/layout/bottom-navigation.tsx
  - src/app/(dashboard)/[teamSlug]/layout.tsx
  - src/app/(dashboard)/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Desktop users see persistent sidebar navigation on left"
    - "Mobile users see bottom navigation bar"
    - "Sidebar hidden on screens <768px"
    - "Bottom nav hidden on screens >=768px"
    - "Clicking nav item loads content in center area"
    - "Current section highlighted with visual indicator"
    - "Athletes see different nav items than coaches"
  artifacts:
    - path: "src/components/layout/navigation-sidebar.tsx"
      provides: "Desktop sidebar navigation with CASL filtering"
      exports: ["NavigationSidebar"]
    - path: "src/components/layout/bottom-navigation.tsx"
      provides: "Mobile bottom navigation with CASL filtering"
      exports: ["BottomNavigation"]
    - path: "src/app/(dashboard)/[teamSlug]/layout.tsx"
      provides: "Team navigation shell wrapping all team pages"
      contains: "NavigationSidebar"
  key_links:
    - from: "src/app/(dashboard)/[teamSlug]/layout.tsx"
      to: "src/components/layout/navigation-sidebar.tsx"
      via: "import NavigationSidebar"
      pattern: "import.*NavigationSidebar"
    - from: "src/app/(dashboard)/[teamSlug]/layout.tsx"
      to: "src/components/layout/bottom-navigation.tsx"
      via: "import BottomNavigation"
      pattern: "import.*BottomNavigation"
    - from: "src/components/layout/navigation-sidebar.tsx"
      to: "src/components/permissions/ability-provider.tsx"
      via: "useAbility hook for role filtering"
      pattern: "useAbility|Can.*ability"
---

<objective>
Implement master-detail navigation layout with responsive sidebar (desktop) and bottom nav (mobile)

Purpose: Replace dashboard card navigation with persistent navigation shell that provides consistent access to all sections
Output: Navigation components and team layout that wraps all [teamSlug] pages
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase context and research
@.planning/phases/18-navigation-redesign/18-CONTEXT.md
@.planning/phases/18-navigation-redesign/18-RESEARCH.md

# Current layout structure
@src/app/(dashboard)/layout.tsx
@src/components/layout/dashboard-header.tsx
@src/components/permissions/ability-provider.tsx
@src/lib/permissions/ability.ts

# Reference for existing patterns
@src/app/(dashboard)/[teamSlug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create desktop navigation sidebar component</name>
  <files>src/components/layout/navigation-sidebar.tsx</files>
  <action>
Create a client component that renders the desktop sidebar navigation.

Structure:
- 'use client' directive (needs usePathname hook)
- Import usePathname from next/navigation for active state
- Import Link from next/link for navigation
- Import icons from lucide-react: Users, Calendar, Package, Settings, Home
- Import useAbility from @/components/permissions/ability-provider for CASL

Props:
- teamSlug: string (for building hrefs)

Navigation items array:
```typescript
const navItems = [
  { href: `/${teamSlug}`, icon: Home, label: 'Home', exact: true },
  { href: `/${teamSlug}/roster`, icon: Users, label: 'Roster' },
  { href: `/${teamSlug}/practices`, icon: Calendar, label: 'Practices' },
  { href: `/${teamSlug}/equipment`, icon: Package, label: 'Equipment', permission: { action: 'manage', subject: 'Equipment' } },
  { href: `/${teamSlug}/settings`, icon: Settings, label: 'Settings', permission: { action: 'manage', subject: 'Team' } },
];
```

Active state logic:
- For 'exact: true' items (Home), match pathname === href
- For others, match pathname.startsWith(href)

Styling:
- Use existing CSS variables: var(--text-primary), var(--text-secondary), var(--text-muted), var(--surface-2), var(--border-subtle)
- Active state: emerald-500/20 background, emerald-500 text
- Hover: surface-2 background, text-primary
- Icons: h-5 w-5, labels: font-medium
- Container: flex flex-col gap-1 p-4
- Each item: flex items-center gap-3 px-4 py-3 rounded-lg transition-colors

Permission filtering:
- For items with permission property, wrap in CASL Can component OR filter using ability.can()
- Use the simpler filter approach: navItems.filter(item => !item.permission || ability.can(item.permission.action, item.permission.subject))

Export: NavigationSidebar
  </action>
  <verify>
- File exists at src/components/layout/navigation-sidebar.tsx
- Component exports NavigationSidebar
- Uses 'use client' directive
- Imports useAbility for CASL filtering
- Has active state styling with emerald colors
  </verify>
  <done>NavigationSidebar component renders desktop navigation with CASL-filtered items and active state highlighting</done>
</task>

<task type="auto">
  <name>Task 2: Create mobile bottom navigation component</name>
  <files>src/components/layout/bottom-navigation.tsx</files>
  <action>
Create a client component that renders the mobile bottom navigation bar.

Structure:
- 'use client' directive
- Import usePathname, Link, lucide-react icons, useAbility

Props:
- teamSlug: string

Navigation items (5 max for iOS tab bar pattern):
```typescript
const navItems = [
  { href: `/${teamSlug}`, icon: Home, label: 'Home', exact: true },
  { href: `/${teamSlug}/roster`, icon: Users, label: 'Roster' },
  { href: `/${teamSlug}/practices`, icon: Calendar, label: 'Practices' },
  { href: `/${teamSlug}/schedule`, icon: CalendarDays, label: 'Schedule' },
  { href: `/${teamSlug}/equipment`, icon: Package, label: 'Equipment', permission: { action: 'manage', subject: 'Equipment' } },
];
```

Note: Settings NOT in bottom nav (per research recommendation - moves to profile menu or accessible from desktop only). Athletes see 4 items (no Equipment), coaches see 5.

Active state logic:
- Same as sidebar: exact match for Home, startsWith for others

Styling:
- Container: bg-[var(--surface-1)] border-t border-[var(--border-subtle)]
- Inner nav: flex justify-around items-center h-16 max-w-screen-sm mx-auto px-2
- Each item: flex flex-col items-center justify-center gap-1 flex-1 h-full min-w-0 transition-colors rounded-lg
- Icons: h-6 w-6 flex-shrink-0
- Labels: text-xs font-medium truncate w-full text-center
- Active: text-emerald-500
- Inactive: text-[var(--text-muted)] active:text-[var(--text-primary)]

Minimum touch target: ensure clickable area is at least 44px (h-16 covers this)

Permission filtering:
- Filter items where user doesn't have permission
- Use ability.can() for filtering

Export: BottomNavigation
  </action>
  <verify>
- File exists at src/components/layout/bottom-navigation.tsx
- Component exports BottomNavigation
- Has 5 nav items max
- Icons h-6 w-6, labels text-xs
- Uses CASL filtering
- Touch targets are h-16 (64px > 44px minimum)
  </verify>
  <done>BottomNavigation component renders mobile bottom nav with CASL-filtered items, proper touch targets, and active state highlighting</done>
</task>

<task type="auto">
  <name>Task 3: Create team layout shell with navigation</name>
  <files>src/app/(dashboard)/[teamSlug]/layout.tsx, src/app/(dashboard)/layout.tsx</files>
  <action>
Create a nested layout at [teamSlug] level that provides the navigation shell.

**Create src/app/(dashboard)/[teamSlug]/layout.tsx:**

This is a Server Component (no 'use client' needed for the layout itself).

```typescript
import { NavigationSidebar } from '@/components/layout/navigation-sidebar';
import { BottomNavigation } from '@/components/layout/bottom-navigation';

interface TeamLayoutProps {
  children: React.ReactNode;
  params: Promise<{ teamSlug: string }>;
}

export default async function TeamLayout({ children, params }: TeamLayoutProps) {
  const { teamSlug } = await params;

  return (
    <div className="flex h-[calc(100vh-4rem)]">
      {/* Desktop sidebar - hidden on mobile */}
      <aside className="hidden md:flex md:w-64 md:flex-col md:border-r md:border-[var(--border-subtle)] bg-[var(--surface-1)]">
        <NavigationSidebar teamSlug={teamSlug} />
      </aside>

      {/* Main content area - scrollable, with bottom padding on mobile for fixed nav */}
      <main className="flex-1 overflow-y-auto pb-20 md:pb-0">
        <div className="container mx-auto px-4 py-8">
          {children}
        </div>
      </main>

      {/* Mobile bottom nav - fixed at bottom, hidden on desktop */}
      <nav className="fixed bottom-0 left-0 right-0 z-50 md:hidden">
        <BottomNavigation teamSlug={teamSlug} />
      </nav>
    </div>
  );
}
```

Key design decisions:
- h-[calc(100vh-4rem)] accounts for header height (h-16 = 4rem)
- Desktop sidebar: hidden md:flex md:w-64 (256px wide)
- Mobile: pb-20 (80px) padding for bottom nav + extra space
- Bottom nav: fixed positioning, z-50 for stacking above content
- Content uses container for max-width consistency

**Update src/app/(dashboard)/layout.tsx:**

Remove the container/padding from main element since nested layout now handles it:

Change:
```tsx
<main className="container mx-auto px-4 py-8">
  {children}
</main>
```

To:
```tsx
<main className="flex-1">
  {children}
</main>
```

This allows the nested [teamSlug]/layout.tsx to control its own layout (flex with sidebar).

IMPORTANT: Keep the existing header, AbilityProvider, PWAWrapper, Toaster, and all other wrappers unchanged. Only modify the main element.
  </action>
  <verify>
- File exists at src/app/(dashboard)/[teamSlug]/layout.tsx
- Imports NavigationSidebar and BottomNavigation
- Has responsive classes: hidden md:flex for sidebar, md:hidden for bottom nav
- Main content has pb-20 md:pb-0 for mobile padding
- Parent layout main element no longer has container/padding classes
- Run `npm run build` to verify no TypeScript errors
  </verify>
  <done>Team layout wraps all [teamSlug] pages with navigation shell - sidebar on desktop, bottom nav on mobile, content in scrollable center area</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build verification:
   ```bash
   npm run build
   ```
   Should complete without errors.

2. Visual verification (dev server):
   ```bash
   npm run dev
   ```
   - Desktop (>768px): Sidebar visible on left, content in center
   - Mobile (<768px): Bottom nav visible at bottom, sidebar hidden
   - Active state highlights current section

3. Navigation verification:
   - Click each nav item - content area updates, nav persists
   - Sidebar scroll position preserved on navigation
   - URL updates correctly for each section

4. Permission verification:
   - As coach: See all nav items including Equipment and Settings
   - As athlete: Equipment and Settings should be hidden (if permissions set correctly)
</verification>

<success_criteria>
- NAV-01: Desktop sidebar displays with Roster, Practices, Equipment, Settings, Home
- NAV-02: Nav items load content in center area without full page reload
- NAV-03: Mobile shows bottom navigation bar with 5 items max
- NAV-04: Mobile content displays above bottom nav with proper padding
- NAV-05: Breakpoint at 768px (md:) switches between layouts
- NAV-06: Active section has emerald highlight color
</success_criteria>

<output>
After completion, create `.planning/phases/18-navigation-redesign/18-01-SUMMARY.md`
</output>
