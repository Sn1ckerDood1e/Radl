---
phase: 22-practice-flow-redesign
plan: 11
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/seasons/season-manager.tsx
  - src/app/(dashboard)/[teamSlug]/practices/page.tsx
  - src/app/api/seasons/[seasonId]/route.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Coaches can create new seasons at any time"
    - "Coaches can archive existing seasons"
    - "Season management is accessible from practices page"
  artifacts:
    - path: "src/components/seasons/season-manager.tsx"
      provides: "Season management UI with create and archive"
      exports: ["SeasonManager"]
    - path: "src/app/api/seasons/[seasonId]/route.ts"
      provides: "Season PATCH endpoint for archiving"
      exports: ["PATCH"]
  key_links:
    - from: "src/app/(dashboard)/[teamSlug]/practices/page.tsx"
      to: "SeasonManager"
      via: "component import and render"
      pattern: "SeasonManager"
---

<objective>
Add season management UI that allows coaches to create new seasons and archive existing ones at any time.

Purpose: GAP-03 identified that CreateSeasonForm only shows when team has zero seasons. Coaches need persistent access to season management.

Output: SeasonManager component with create/archive functionality, integrated into practices page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-practice-flow-redesign/22-VERIFICATION.md
@src/components/seasons/create-season-form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SeasonManager component</name>
  <files>
    src/components/seasons/season-manager.tsx
  </files>
  <action>
Create a new SeasonManager component that provides full season management:

1. Props: teamSlug, seasons (array of { id, name, status, startDate, endDate })
2. State: isCreateOpen (boolean), selectedSeason (for editing)
3. Display current seasons in a compact list:
   - Season name with status badge (ACTIVE in emerald, ARCHIVED in zinc)
   - Start/end dates if present
   - Archive button (only for ACTIVE seasons)
4. "New Season" button at top opens inline create form (reuse CreateSeasonForm logic)
5. Archive action calls PATCH /api/seasons/[id] with { status: 'ARCHIVED' }
6. Use Drawer component (from shadcn) for mobile-friendly slide-up panel
7. Trigger button shows as gear icon (Settings2 from lucide-react) next to season selector

Style:
- Compact design that doesn't dominate the page
- Confirmation dialog before archive ("Archive [name]? Practices will remain but season won't appear in selectors.")
- Toast feedback on success/error using sonner
  </action>
  <verify>
Component renders season list with archive buttons
Create form opens and successfully creates new season
Archive button updates season status to ARCHIVED
Toast shows on success/error
  </verify>
  <done>
SeasonManager component provides create and archive functionality for seasons.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add season PATCH endpoint and integrate</name>
  <files>
    src/app/api/seasons/[seasonId]/route.ts
    src/app/(dashboard)/[teamSlug]/practices/page.tsx
  </files>
  <action>
1. Create /api/seasons/[seasonId]/route.ts with PATCH handler:
   - Validate seasonId belongs to user's team
   - Accept { status: 'ACTIVE' | 'ARCHIVED', name?, startDate?, endDate? }
   - Return updated season
   - Use getClaimsForApiRoute for auth

2. Update practices page to include SeasonManager:
   - Fetch seasons with full details (id, name, status, startDate, endDate)
   - Add SeasonManager component next to season filter dropdown (coaches only)
   - Pass seasons and teamSlug to SeasonManager

The SeasonManager should appear as a small icon button that opens a drawer/popover with full management UI.
  </action>
  <verify>
PATCH /api/seasons/[id] updates season status successfully
curl -X PATCH /api/seasons/[id] -d '{"status":"ARCHIVED"}' returns updated season
Practices page shows season management button for coaches
Creating new season adds it to the list
Archiving season removes it from active filter
  </verify>
  <done>
Season management fully integrated into practices page with API support.
  </done>
</task>

</tasks>

<verification>
- [ ] TypeScript compiles without errors
- [ ] SeasonManager component renders correctly
- [ ] New season creation works
- [ ] Archive season updates status via API
- [ ] Practices page shows season management for coaches
- [ ] Archived seasons don't appear in practice filters
</verification>

<success_criteria>
Coaches can create new seasons and archive old ones at any time from the practices page. Season management is always accessible, not just when zero seasons exist.
</success_criteria>

<output>
After completion, create `.planning/phases/22-practice-flow-redesign/22-11-SUMMARY.md`
</output>
