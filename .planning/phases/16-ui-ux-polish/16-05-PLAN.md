---
phase: 16-ui-ux-polish
plan: 05
type: execute
wave: 2
depends_on: []
files_modified:
  - src/hooks/use-onboarding.ts
  - src/components/onboarding/onboarding-wizard.tsx
  - src/components/onboarding/onboarding-steps.tsx
  - src/app/(dashboard)/[teamSlug]/page.tsx
autonomous: true

must_haves:
  truths:
    - "New users see onboarding wizard on first visit to team dashboard"
    - "Wizard shows step progress (Step 2 of 4)"
    - "Users can skip onboarding at any time"
    - "Onboarding completion is stored and never shows again"
    - "Wizard guides through first practice creation flow"
  artifacts:
    - path: "src/hooks/use-onboarding.ts"
      provides: "Hook for onboarding state management"
      exports: ["useOnboarding"]
    - path: "src/components/onboarding/onboarding-wizard.tsx"
      provides: "Multi-step onboarding wizard"
      exports: ["OnboardingWizard"]
    - path: "src/components/onboarding/onboarding-steps.tsx"
      provides: "Individual step content components"
      exports: ["WelcomeStep", "RosterStep", "PracticeStep", "CompleteStep"]
  key_links:
    - from: "src/app/(dashboard)/[teamSlug]/page.tsx"
      to: "OnboardingWizard"
      via: "conditional render"
      pattern: "showOnboarding.*OnboardingWizard"
    - from: "useOnboarding"
      to: "localStorage"
      via: "persistence"
      pattern: "localStorage.*onboarding"
---

<objective>
Implement onboarding flow for new users.

Purpose: UIX-08 requires guiding new users through their first steps. The onboarding wizard introduces key features and guides toward creating the first practice - the core value of the application.

Output: Onboarding wizard with 4 steps: welcome, roster overview, practice creation prompt, completion celebration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/16-ui-ux-polish/16-CONTEXT.md
@.planning/phases/16-ui-ux-polish/16-RESEARCH.md

Reference dashboard page:
@src/app/(dashboard)/[teamSlug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create onboarding state hook with localStorage persistence</name>
  <files>
    src/hooks/use-onboarding.ts
  </files>
  <action>
Create the onboarding state management hook at `src/hooks/use-onboarding.ts`:

```tsx
'use client';

import { useState, useEffect, useCallback } from 'react';

const STORAGE_KEY = 'rowops-onboarding';

interface OnboardingState {
  completed: boolean;
  currentStep: number;
  skipped: boolean;
  completedAt?: string;
}

const defaultState: OnboardingState = {
  completed: false,
  currentStep: 0,
  skipped: false,
};

export function useOnboarding(teamId: string) {
  const [state, setState] = useState<OnboardingState | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  // Key is team-specific so each team can have own onboarding
  const storageKey = `${STORAGE_KEY}-${teamId}`;

  // Load state from localStorage
  useEffect(() => {
    if (typeof window === 'undefined') return;

    try {
      const stored = localStorage.getItem(storageKey);
      if (stored) {
        setState(JSON.parse(stored));
      } else {
        setState(defaultState);
      }
    } catch {
      setState(defaultState);
    }
    setIsLoading(false);
  }, [storageKey]);

  // Persist state changes
  const persistState = useCallback((newState: OnboardingState) => {
    setState(newState);
    try {
      localStorage.setItem(storageKey, JSON.stringify(newState));
    } catch {
      // localStorage might be full or disabled
    }
  }, [storageKey]);

  // Actions
  const nextStep = useCallback(() => {
    if (!state) return;
    persistState({ ...state, currentStep: state.currentStep + 1 });
  }, [state, persistState]);

  const prevStep = useCallback(() => {
    if (!state) return;
    persistState({ ...state, currentStep: Math.max(0, state.currentStep - 1) });
  }, [state, persistState]);

  const goToStep = useCallback((step: number) => {
    if (!state) return;
    persistState({ ...state, currentStep: step });
  }, [state, persistState]);

  const complete = useCallback(() => {
    persistState({
      completed: true,
      currentStep: 0,
      skipped: false,
      completedAt: new Date().toISOString(),
    });
  }, [persistState]);

  const skip = useCallback(() => {
    persistState({
      completed: true,
      currentStep: 0,
      skipped: true,
      completedAt: new Date().toISOString(),
    });
  }, [persistState]);

  const reset = useCallback(() => {
    persistState(defaultState);
  }, [persistState]);

  return {
    // State
    isLoading,
    showOnboarding: !isLoading && state && !state.completed,
    currentStep: state?.currentStep ?? 0,
    hasCompleted: state?.completed ?? false,
    wasSkipped: state?.skipped ?? false,

    // Actions
    nextStep,
    prevStep,
    goToStep,
    complete,
    skip,
    reset,
  };
}
```

Features:
- Team-specific storage (different teams can have different onboarding states)
- SSR-safe (checks for window, loading state)
- Supports step navigation (next, prev, goTo)
- Tracks completion vs skip
- Reset function for testing/debugging
  </action>
  <verify>
    - `cat src/hooks/use-onboarding.ts` shows useOnboarding hook
    - `pnpm tsc --noEmit` passes
  </verify>
  <done>
    Onboarding hook created with localStorage persistence, team-specific storage, and step management.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create onboarding wizard and step components</name>
  <files>
    src/components/onboarding/onboarding-wizard.tsx
    src/components/onboarding/onboarding-steps.tsx
  </files>
  <action>
1. Create step components at `src/components/onboarding/onboarding-steps.tsx`:

```tsx
'use client';

import Link from 'next/link';
import { Users, Calendar, Sparkles, ArrowRight } from 'lucide-react';
import { Button } from '@/components/ui/button';

interface StepProps {
  teamSlug: string;
  teamName: string;
  onNext: () => void;
  onComplete: () => void;
}

export function WelcomeStep({ teamName, onNext }: StepProps) {
  return (
    <div className="text-center">
      <div className="mx-auto h-20 w-20 rounded-full bg-emerald-500/20 flex items-center justify-center mb-6">
        <Sparkles className="h-10 w-10 text-emerald-400" />
      </div>
      <h2 className="text-2xl font-bold text-white mb-3">
        Welcome to {teamName}!
      </h2>
      <p className="text-zinc-400 mb-8 max-w-md mx-auto">
        Let&apos;s get you set up. We&apos;ll walk through the key features
        to help you plan practices and manage your team.
      </p>
      <Button onClick={onNext} size="lg">
        Get Started
        <ArrowRight className="ml-2 h-4 w-4" />
      </Button>
    </div>
  );
}

export function RosterStep({ teamSlug, onNext }: StepProps) {
  return (
    <div className="text-center">
      <div className="mx-auto h-20 w-20 rounded-full bg-blue-500/20 flex items-center justify-center mb-6">
        <Users className="h-10 w-10 text-blue-400" />
      </div>
      <h2 className="text-2xl font-bold text-white mb-3">
        Your Team Roster
      </h2>
      <p className="text-zinc-400 mb-6 max-w-md mx-auto">
        The roster shows all team members. As a coach, you can invite
        athletes and parents using the team join code.
      </p>
      <div className="flex flex-col sm:flex-row gap-3 justify-center">
        <Button variant="outline" asChild>
          <Link href={`/${teamSlug}/roster`}>View Roster</Link>
        </Button>
        <Button onClick={onNext}>
          Continue
          <ArrowRight className="ml-2 h-4 w-4" />
        </Button>
      </div>
    </div>
  );
}

export function PracticeStep({ teamSlug, onNext, onComplete }: StepProps) {
  return (
    <div className="text-center">
      <div className="mx-auto h-20 w-20 rounded-full bg-orange-500/20 flex items-center justify-center mb-6">
        <Calendar className="h-10 w-10 text-orange-400" />
      </div>
      <h2 className="text-2xl font-bold text-white mb-3">
        Create Your First Practice
      </h2>
      <p className="text-zinc-400 mb-6 max-w-md mx-auto">
        Practices are where the magic happens. Create time blocks for water,
        land, or erg sessions. Assign lineups and equipment.
      </p>
      <div className="flex flex-col sm:flex-row gap-3 justify-center">
        <Button variant="outline" onClick={onComplete}>
          I&apos;ll do this later
        </Button>
        <Button asChild>
          <Link href={`/${teamSlug}/practices/new`}>
            Create Practice
            <ArrowRight className="ml-2 h-4 w-4" />
          </Link>
        </Button>
      </div>
    </div>
  );
}

export function CompleteStep({ teamSlug, onComplete }: StepProps) {
  return (
    <div className="text-center">
      <div className="mx-auto h-20 w-20 rounded-full bg-emerald-500/20 flex items-center justify-center mb-6 animate-in zoom-in duration-300">
        <Sparkles className="h-10 w-10 text-emerald-400" />
      </div>
      <h2 className="text-2xl font-bold text-white mb-3">
        You&apos;re All Set!
      </h2>
      <p className="text-zinc-400 mb-6 max-w-md mx-auto">
        You&apos;re ready to start managing your team. Explore the dashboard
        or dive into creating your first practice.
      </p>
      <div className="flex flex-col sm:flex-row gap-3 justify-center">
        <Button variant="outline" onClick={onComplete}>
          Go to Dashboard
        </Button>
        <Button asChild>
          <Link href={`/${teamSlug}/practices/new`}>
            Create Practice
          </Link>
        </Button>
      </div>
    </div>
  );
}
```

2. Create wizard container at `src/components/onboarding/onboarding-wizard.tsx`:

```tsx
'use client';

import { X } from 'lucide-react';
import { Button } from '@/components/ui/button';
import {
  WelcomeStep,
  RosterStep,
  PracticeStep,
  CompleteStep,
} from './onboarding-steps';

const TOTAL_STEPS = 4;

interface OnboardingWizardProps {
  teamSlug: string;
  teamName: string;
  currentStep: number;
  onNext: () => void;
  onPrev: () => void;
  onSkip: () => void;
  onComplete: () => void;
}

export function OnboardingWizard({
  teamSlug,
  teamName,
  currentStep,
  onNext,
  onPrev,
  onSkip,
  onComplete,
}: OnboardingWizardProps) {
  const stepProps = { teamSlug, teamName, onNext, onComplete };

  const renderStep = () => {
    switch (currentStep) {
      case 0: return <WelcomeStep {...stepProps} />;
      case 1: return <RosterStep {...stepProps} />;
      case 2: return <PracticeStep {...stepProps} />;
      case 3: return <CompleteStep {...stepProps} />;
      default: return <CompleteStep {...stepProps} />;
    }
  };

  return (
    <div className="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm">
      <div className="fixed inset-x-4 top-1/2 -translate-y-1/2 sm:inset-x-auto sm:left-1/2 sm:-translate-x-1/2 sm:max-w-lg w-full">
        <div className="bg-zinc-900 border border-zinc-800 rounded-2xl p-8 relative animate-in zoom-in-95 fade-in duration-300">
          {/* Skip button */}
          <Button
            variant="ghost"
            size="icon-sm"
            className="absolute top-4 right-4"
            onClick={onSkip}
            aria-label="Skip onboarding"
          >
            <X className="h-4 w-4" />
          </Button>

          {/* Progress indicator */}
          <div className="flex items-center justify-center gap-2 mb-8">
            {Array.from({ length: TOTAL_STEPS }).map((_, i) => (
              <div
                key={i}
                className={`h-2 w-2 rounded-full transition-colors ${
                  i === currentStep
                    ? 'bg-emerald-500'
                    : i < currentStep
                    ? 'bg-emerald-500/50'
                    : 'bg-zinc-700'
                }`}
              />
            ))}
          </div>

          {/* Step content */}
          <div className="min-h-[300px] flex items-center justify-center">
            {renderStep()}
          </div>

          {/* Step counter */}
          <p className="text-center text-sm text-zinc-500 mt-6">
            Step {currentStep + 1} of {TOTAL_STEPS}
          </p>
        </div>
      </div>
    </div>
  );
}
```
  </action>
  <verify>
    - `cat src/components/onboarding/onboarding-steps.tsx` shows 4 step components
    - `cat src/components/onboarding/onboarding-wizard.tsx` shows wizard container
    - `pnpm tsc --noEmit` passes
  </verify>
  <done>
    Onboarding wizard created with 4 steps: welcome, roster intro, practice creation prompt, and completion. Includes progress dots, skip button, and step counter.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate onboarding into team dashboard</name>
  <files>
    src/app/(dashboard)/[teamSlug]/page.tsx
    src/components/dashboard/dashboard-content.tsx
  </files>
  <action>
The team dashboard page is a server component. We need to create a client wrapper for onboarding.

1. First, read the current dashboard page structure to understand it.

2. Create client component at `src/components/dashboard/dashboard-with-onboarding.tsx`:
   ```tsx
   'use client';

   import { useOnboarding } from '@/hooks/use-onboarding';
   import { OnboardingWizard } from '@/components/onboarding/onboarding-wizard';

   interface DashboardWithOnboardingProps {
     teamId: string;
     teamSlug: string;
     teamName: string;
     isCoach: boolean;
     children: React.ReactNode;
   }

   export function DashboardWithOnboarding({
     teamId,
     teamSlug,
     teamName,
     isCoach,
     children,
   }: DashboardWithOnboardingProps) {
     const {
       showOnboarding,
       currentStep,
       nextStep,
       prevStep,
       skip,
       complete,
       isLoading,
     } = useOnboarding(teamId);

     // Only show onboarding for coaches (they're the primary setup users)
     const shouldShowOnboarding = isCoach && showOnboarding && !isLoading;

     return (
       <>
         {children}
         {shouldShowOnboarding && (
           <OnboardingWizard
             teamSlug={teamSlug}
             teamName={teamName}
             currentStep={currentStep}
             onNext={nextStep}
             onPrev={prevStep}
             onSkip={skip}
             onComplete={complete}
           />
         )}
       </>
     );
   }
   ```

3. Update `src/app/(dashboard)/[teamSlug]/page.tsx`:
   - Import DashboardWithOnboarding
   - Wrap the page content with DashboardWithOnboarding
   - Pass teamId, teamSlug, teamName, isCoach props

   ```tsx
   // At the end of the component, wrap return:
   return (
     <DashboardWithOnboarding
       teamId={team.id}
       teamSlug={teamSlug}
       teamName={team.name}
       isCoach={isCoach}
     >
       {/* existing dashboard content */}
     </DashboardWithOnboarding>
   );
   ```
  </action>
  <verify>
    - `cat src/components/dashboard/dashboard-with-onboarding.tsx` shows wrapper component
    - `grep -n "DashboardWithOnboarding" src/app/(dashboard)/[teamSlug]/page.tsx` shows integration
    - `pnpm tsc --noEmit` passes
    - Manual: Clear localStorage and visit team dashboard to see onboarding
  </verify>
  <done>
    Onboarding wizard integrated into team dashboard. Shows for coaches on first visit, persists completion in localStorage, can be skipped at any time.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `pnpm tsc --noEmit`
2. Clear localStorage key `rowops-onboarding-{teamId}` and visit dashboard
3. Onboarding wizard appears with welcome step
4. Progress dots show current step
5. Can navigate through all 4 steps
6. Skip button closes and persists completion
7. Completing final step closes wizard
8. Returning to dashboard does not show onboarding again
</verification>

<success_criteria>
- useOnboarding hook manages state with localStorage persistence
- OnboardingWizard shows 4 steps with progress indicator
- Coaches see onboarding on first visit to team dashboard
- Skip button available at all times
- Onboarding completion persisted (never shows again)
- Step counter shows "Step X of 4"
- Wizard links to relevant pages (roster, practices/new)
</success_criteria>

<output>
After completion, create `.planning/phases/16-ui-ux-polish/16-05-SUMMARY.md`
</output>
