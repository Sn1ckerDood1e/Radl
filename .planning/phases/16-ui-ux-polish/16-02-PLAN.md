---
phase: 16-ui-ux-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/inline-success.tsx
  - src/lib/toast-helpers.ts
  - src/components/regatta-central/rc-settings-section.tsx
  - src/components/equipment/damage-report-form.tsx
autonomous: true

must_haves:
  truths:
    - "API errors show toast with Retry action button"
    - "Success states show brief toast for major actions"
    - "Quick saves show inline checkmark animation"
    - "Error toasts persist until dismissed"
  artifacts:
    - path: "src/components/ui/inline-success.tsx"
      provides: "Animated checkmark for inline success feedback"
      exports: ["InlineSuccess"]
    - path: "src/lib/toast-helpers.ts"
      provides: "Reusable toast patterns with retry actions"
      exports: ["showErrorToast", "showSuccessToast", "showActionableError"]
  key_links:
    - from: "src/lib/toast-helpers.ts"
      to: "sonner"
      via: "import toast"
      pattern: "import.*toast.*from.*sonner"
---

<objective>
Create error handling UI patterns and micro-animation utilities.

Purpose: UIX-04 (error handling with recovery) and UIX-07 (micro-animations) establish consistent feedback patterns. Actionable error toasts help users recover from failures. Inline success animations provide quick feedback without toast spam.

Output: InlineSuccess component, toast helper functions with retry patterns, updated existing forms to use new patterns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/16-ui-ux-polish/16-CONTEXT.md
@.planning/phases/16-ui-ux-polish/16-RESEARCH.md

Reference existing toast usage:
@src/app/(dashboard)/layout.tsx (Toaster configuration)
@src/components/regatta-central/rc-settings-section.tsx (existing toast usage)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create InlineSuccess component and toast helpers</name>
  <files>
    src/components/ui/inline-success.tsx
    src/lib/toast-helpers.ts
  </files>
  <action>
1. Create InlineSuccess component at `src/components/ui/inline-success.tsx`:
   - Animated checkmark icon that appears with zoom-in and fade-in
   - Props: size?: 'sm' | 'md' | 'lg' (default 'md'), className?: string
   - Use CheckCircle from lucide-react
   - Animation: animate-in zoom-in fade-in duration-200 (from tw-animate-css)
   - Color: text-emerald-500
   - Size mapping: sm=h-4 w-4, md=h-5 w-5, lg=h-6 w-6
   - Auto-hide after delay? Consider prop: autoHide?: boolean, hideDelay?: number (default 2000ms)
   - If autoHide, use animate-out fade-out after delay

2. Create toast helper functions at `src/lib/toast-helpers.ts`:
   ```tsx
   import { toast } from 'sonner';

   interface ErrorToastOptions {
     message: string;
     description?: string;
     retry?: () => void | Promise<void>;
   }

   export function showErrorToast({ message, description, retry }: ErrorToastOptions) {
     toast.error(message, {
       description,
       duration: Infinity, // Persist until dismissed
       action: retry ? {
         label: 'Retry',
         onClick: retry,
       } : undefined,
     });
   }

   export function showSuccessToast(message: string, description?: string) {
     toast.success(message, {
       description,
       duration: 4000, // Auto-dismiss after 4s
     });
   }

   // For save failures with form data retry
   export function showActionableError<T>(
     message: string,
     data: T,
     retryFn: (data: T) => Promise<void>
   ) {
     toast.error(message, {
       duration: Infinity,
       action: {
         label: 'Retry',
         onClick: () => retryFn(data),
       },
     });
   }
   ```
  </action>
  <verify>
    - `cat src/components/ui/inline-success.tsx` shows component with animation classes
    - `cat src/lib/toast-helpers.ts` exports showErrorToast, showSuccessToast, showActionableError
    - `pnpm tsc --noEmit` passes
  </verify>
  <done>
    InlineSuccess component created with zoom/fade animation. Toast helpers provide consistent error/success patterns with retry action support.
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply toast patterns to existing error handling</name>
  <files>
    src/components/regatta-central/rc-settings-section.tsx
    src/components/equipment/damage-report-form.tsx
    src/components/forms/create-team-form.tsx
    src/components/forms/invite-member-form.tsx
  </files>
  <action>
Update existing components to use the new toast patterns:

1. **rc-settings-section.tsx:**
   - Import showErrorToast and showSuccessToast from '@/lib/toast-helpers'
   - Replace direct toast.error() calls with showErrorToast({ message, retry: () => handleAction() })
   - Ensure OAuth connection errors have retry action
   - Import sync errors should offer retry

2. **damage-report-form.tsx:**
   - On submit error: use showErrorToast with retry action that re-submits the form
   - On success: use showSuccessToast("Damage reported")

3. **create-team-form.tsx:**
   - Replace the error div display with showErrorToast
   - Keep inline error for form validation (field-level), use toast for API errors
   - On team creation success: showSuccessToast("Team created")

4. **invite-member-form.tsx:**
   - On invite error: showErrorToast with retry
   - On success: showSuccessToast("Invitation sent")

Pattern to follow:
```tsx
const handleSubmit = async (data: FormData) => {
  try {
    await apiCall(data);
    showSuccessToast('Action completed');
  } catch (error) {
    showErrorToast({
      message: 'Failed to complete action',
      description: error instanceof Error ? error.message : 'Unknown error',
      retry: () => handleSubmit(data),
    });
  }
};
```
  </action>
  <verify>
    - `pnpm tsc --noEmit` passes
    - `grep -r "showErrorToast\|showSuccessToast" src/components/` shows usage in updated files
    - Manual: Trigger an error (e.g., disconnect network) and verify toast has Retry button
  </verify>
  <done>
    Existing forms use toast helpers with actionable retry buttons for errors and brief success toasts.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add micro-animation utilities and patterns</name>
  <files>
    src/lib/animation-utils.ts
    src/components/ui/animated-list-item.tsx
  </files>
  <action>
Create animation utilities for consistent micro-animations:

1. Create `src/lib/animation-utils.ts`:
   ```tsx
   // Animation class presets using tw-animate-css
   export const animations = {
     // Enter animations
     fadeIn: 'animate-in fade-in duration-200',
     slideInFromBottom: 'animate-in fade-in slide-in-from-bottom-2 duration-200',
     slideInFromRight: 'animate-in fade-in slide-in-from-right-2 duration-200',
     zoomIn: 'animate-in zoom-in-95 fade-in duration-200',

     // Exit animations
     fadeOut: 'animate-out fade-out duration-200',
     slideOutToRight: 'animate-out fade-out slide-out-to-right duration-300',
     slideOutToLeft: 'animate-out fade-out slide-out-to-left duration-300',
     zoomOut: 'animate-out zoom-out-95 fade-out duration-200',

     // Success state
     successPop: 'animate-in zoom-in fade-in duration-200',
   } as const;

   // Helper to combine animation with existing classes
   export function withAnimation(
     animation: keyof typeof animations,
     className?: string
   ): string {
     return `${animations[animation]} ${className || ''}`.trim();
   }
   ```

2. Create `src/components/ui/animated-list-item.tsx`:
   - Wrapper component for list items with enter/exit animations
   - Props: children, isExiting?: boolean, index?: number (for stagger delay)
   - Enter: slideInFromBottom with optional stagger (index * 50ms delay)
   - Exit: slideOutToRight when isExiting is true
   - Use cn() for className composition

   ```tsx
   interface AnimatedListItemProps {
     children: React.ReactNode;
     isExiting?: boolean;
     index?: number;
     className?: string;
   }

   export function AnimatedListItem({ children, isExiting, index = 0, className }: AnimatedListItemProps) {
     const delay = index * 50; // 50ms stagger per item

     return (
       <div
         className={cn(
           isExiting ? animations.slideOutToRight : animations.slideInFromBottom,
           className
         )}
         style={{ animationDelay: isExiting ? undefined : `${delay}ms` }}
       >
         {children}
       </div>
     );
   }
   ```
  </action>
  <verify>
    - `cat src/lib/animation-utils.ts` shows animation presets
    - `cat src/components/ui/animated-list-item.tsx` shows AnimatedListItem component
    - `pnpm tsc --noEmit` passes
  </verify>
  <done>
    Animation utilities created with presets for enter/exit animations. AnimatedListItem provides consistent list item animations with stagger support.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `pnpm tsc --noEmit`
2. InlineSuccess component renders animated checkmark
3. Toast helpers produce toasts with action buttons
4. Animation utilities export consistent class strings
5. Manual: Trigger API error and verify Retry button works
</verification>

<success_criteria>
- InlineSuccess component available with zoom/fade animation
- showErrorToast, showSuccessToast, showActionableError exported from toast-helpers
- At least 4 existing forms updated to use new toast patterns
- Animation utilities provide consistent enter/exit class strings
- Error toasts persist until dismissed and have Retry action
- Success toasts auto-dismiss after 4 seconds
</success_criteria>

<output>
After completion, create `.planning/phases/16-ui-ux-polish/16-02-SUMMARY.md`
</output>
