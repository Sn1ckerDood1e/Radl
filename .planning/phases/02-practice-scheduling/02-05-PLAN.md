---
phase: 02-practice-scheduling
plan: 05
type: execute
wave: 3
depends_on: ["02-01", "02-02"]
files_modified:
  - src/app/(dashboard)/[teamSlug]/practices/page.tsx
  - src/app/(dashboard)/[teamSlug]/practices/new/page.tsx
  - src/app/(dashboard)/[teamSlug]/practices/[id]/page.tsx
  - src/components/practices/practice-form.tsx
  - src/components/practices/block-editor.tsx
  - src/components/practices/block-card.tsx
autonomous: true

must_haves:
  truths:
    - "Coach can create a practice with date, time, name, and blocks"
    - "Coach can add, remove, and reorder blocks in practice"
    - "Coach can edit existing practice details"
    - "Practice form validates inputs before submission"
  artifacts:
    - path: "src/app/(dashboard)/[teamSlug]/practices/new/page.tsx"
      provides: "Create practice page"
      min_lines: 20
    - path: "src/app/(dashboard)/[teamSlug]/practices/[id]/page.tsx"
      provides: "Practice detail/edit page"
      min_lines: 30
    - path: "src/components/practices/practice-form.tsx"
      provides: "Reusable practice form component"
      exports: ["PracticeForm"]
    - path: "src/components/practices/block-editor.tsx"
      provides: "Block sequence editor with drag-drop"
      exports: ["BlockEditor"]
  key_links:
    - from: "src/components/practices/practice-form.tsx"
      to: "/api/practices"
      via: "fetch POST/PATCH"
      pattern: "fetch.*api/practices"
    - from: "src/components/practices/block-editor.tsx"
      to: "block-card.tsx"
      via: "renders BlockCard"
      pattern: "BlockCard"
---

<objective>
Build the practice management UI: create/edit forms with block editor for coaches.

Purpose: This UI enables coaches to actually use the practice scheduling system - creating practices, adding blocks, and managing practice structure.
Output: Functional practice creation and editing pages with intuitive block management.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/02-practice-scheduling/02-CONTEXT.md
@.planning/phases/02-practice-scheduling/02-01-SUMMARY.md
@.planning/phases/02-practice-scheduling/02-02-SUMMARY.md

# Existing UI patterns
@src/components/equipment/equipment-form.tsx
@src/components/forms/create-team-form.tsx
@src/app/(dashboard)/[teamSlug]/equipment/new/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create block components</name>
  <files>src/components/practices/block-card.tsx, src/components/practices/block-editor.tsx</files>
  <action>
Create src/components/practices/block-card.tsx:

A card component for displaying/editing a single block:
```typescript
'use client';

import { useState } from 'react';
import { BlockType } from '@/generated/prisma';
import { Trash2, GripVertical, ChevronDown, ChevronUp } from 'lucide-react';

interface BlockCardProps {
  block: {
    id?: string;
    type: BlockType;
    durationMinutes?: number | null;
    category?: string | null;
    notes?: string | null;
  };
  position: number;
  onUpdate: (block: Partial<BlockCardProps['block']>) => void;
  onRemove: () => void;
  dragHandleProps?: object; // For drag-and-drop
}
```

Features:
- Display block type with color coding (WATER=blue, LAND=green, ERG=orange)
- Show position number
- Collapsible details (duration, category, notes)
- Edit fields inline
- Delete button
- Drag handle for reordering (using dragHandleProps)

Use Tailwind for styling, match existing dark theme.

Create src/components/practices/block-editor.tsx:

A list editor for managing blocks:
```typescript
'use client';

import { useState } from 'react';
import { BlockCard } from './block-card';
import { Plus } from 'lucide-react';
import { BlockType } from '@/generated/prisma';

interface Block {
  id?: string;
  tempId?: string; // For new unsaved blocks
  type: BlockType;
  durationMinutes?: number | null;
  category?: string | null;
  notes?: string | null;
}

interface BlockEditorProps {
  blocks: Block[];
  onChange: (blocks: Block[]) => void;
}
```

Features:
- Render BlockCard for each block with position
- "Add Block" button that opens type selector (WATER, LAND, ERG)
- Reorder via up/down buttons (simpler than drag-drop for MVP)
- Track new blocks with tempId (converted to real id on save)
- onChange callback for parent form integration

Use nanoid for generating tempIds for new blocks.
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>Block display and editor components created</done>
</task>

<task type="auto">
  <name>Task 2: Create practice form component</name>
  <files>src/components/practices/practice-form.tsx</files>
  <action>
Create src/components/practices/practice-form.tsx:

A form for creating/editing practices:
```typescript
'use client';

import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useRouter } from 'next/navigation';
import { BlockEditor } from './block-editor';
import { createPracticeFormSchema, type CreatePracticeFormInput } from '@/lib/validations/practice';

interface PracticeFormProps {
  teamSlug: string;
  seasonId: string;
  practice?: {
    id: string;
    name: string;
    date: Date;
    startTime: Date;
    endTime: Date;
    notes?: string | null;
    blocks: Array<{
      id: string;
      type: BlockType;
      durationMinutes?: number | null;
      category?: string | null;
      notes?: string | null;
    }>;
  };
  onSuccess?: () => void;
}
```

Form fields:
- name: text input
- date: date picker (HTML input type="date")
- startTime: time picker (HTML input type="time")
- endTime: time picker (HTML input type="time")
- notes: textarea (optional)
- blocks: BlockEditor component

Features:
- Create mode (no practice prop) or edit mode (practice prop)
- Validation with createPracticeFormSchema
- Submit to POST /api/practices (create) or PATCH /api/practices/[id] (edit)
- Loading state during submit
- Error display from API
- Redirect to practice detail on success

Use react-hook-form with zodResolver. Follow patterns from equipment-form.tsx.

Add form schema variant in src/lib/validations/practice.ts:
```typescript
// For form - allows empty strings, converts date/time strings
export const createPracticeFormSchema = z.object({
  seasonId: z.string().uuid(),
  name: z.string().min(1, 'Name is required').max(100),
  date: z.string().min(1, 'Date is required'), // YYYY-MM-DD
  startTime: z.string().min(1, 'Start time is required'), // HH:MM
  endTime: z.string().min(1, 'End time is required'), // HH:MM
  notes: z.string().max(1000).optional().or(z.literal('')),
  blocks: z.array(createBlockSchema).min(1, 'At least one block required'),
}).refine(
  (data) => data.startTime < data.endTime,
  { message: 'End time must be after start time', path: ['endTime'] }
);
```
  </action>
  <verify>Run `npx tsc --noEmit` - no type errors</verify>
  <done>Practice form component with validation and block editor</done>
</task>

<task type="auto">
  <name>Task 3: Create practice pages</name>
  <files>src/app/(dashboard)/[teamSlug]/practices/page.tsx, src/app/(dashboard)/[teamSlug]/practices/new/page.tsx, src/app/(dashboard)/[teamSlug]/practices/[id]/page.tsx</files>
  <action>
Create src/app/(dashboard)/[teamSlug]/practices/page.tsx:

Practices list page:
- Server component
- Fetch practices for current season (or show season selector)
- Display as simple list with date, name, status badge
- "New Practice" button (coach only)
- Link each practice to detail page
- Note: Calendar view is separate (Plan 06), this is a simple list

Create src/app/(dashboard)/[teamSlug]/practices/new/page.tsx:

Create practice page:
- Server component wrapper
- Fetch current/active season for form
- Render PracticeForm in create mode
- Coach only (redirect if not coach)

Create src/app/(dashboard)/[teamSlug]/practices/[id]/page.tsx:

Practice detail/edit page:
- Server component
- Fetch practice with blocks
- For coaches: editable view with PracticeForm
- For athletes: read-only view (only if PUBLISHED)
- Show practice status (DRAFT/PUBLISHED)
- Publish button for drafts (coach only)
- Delete button (coach only, with confirmation)

Follow existing page patterns:
- Use params.teamSlug for navigation
- Client components for interactive parts
- Server components for data fetching
  </action>
  <verify>
Run `npx tsc --noEmit` - no type errors
Pages exist at expected routes
  </verify>
  <done>Practice list, create, and detail pages functional</done>
</task>

</tasks>

<verification>
All checks must pass:
1. `npx tsc --noEmit` - all files compile
2. /[teamSlug]/practices - lists practices
3. /[teamSlug]/practices/new - shows create form (coach only)
4. /[teamSlug]/practices/[id] - shows practice detail
5. Block editor allows add, remove, reorder blocks
6. Form validation works (required fields, time logic)
</verification>

<success_criteria>
- Coach can create practice with date, time, blocks (PRAC-01)
- Coach can add block metadata (PRAC-02)
- Coach can edit existing practices
- Coach can publish draft practices
- Athletes see read-only view of published practices
- Form validates before submission
</success_criteria>

<output>
After completion, create `.planning/phases/02-practice-scheduling/02-05-SUMMARY.md`
</output>
