---
phase: 17-facility-ui-features
plan: 03
type: execute
wave: 2
depends_on: [17-02]
files_modified:
  - src/app/(dashboard)/facility/[facilitySlug]/clubs/page.tsx
  - src/app/(dashboard)/facility/[facilitySlug]/clubs/loading.tsx
autonomous: true

must_haves:
  truths:
    - "Facility admin can view all clubs under facility in alphabetical order"
    - "Each club card shows member count and equipment count"
    - "Clicking a club navigates to that club's dashboard"
    - "Facility admin has full admin actions on club drill-down"
  artifacts:
    - path: "src/app/(dashboard)/facility/[facilitySlug]/clubs/page.tsx"
      provides: "Club list page with drill-down navigation"
      min_lines: 100
    - path: "src/app/(dashboard)/facility/[facilitySlug]/clubs/loading.tsx"
      provides: "Skeleton loading state for clubs list"
      min_lines: 15
  key_links:
    - from: "src/app/(dashboard)/facility/[facilitySlug]/clubs/page.tsx"
      to: "prisma.team"
      via: "database query for clubs"
      pattern: "prisma\\.team\\.findMany"
---

<objective>
Create the clubs list page for facility admins to view and drill down into clubs.

Purpose: Facility admins need to see all clubs under their facility and access club dashboards with full admin capabilities (FAC-05).

Output: Clubs page showing alphabetical list of clubs with stats and drill-down links.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/17-facility-ui-features/17-CONTEXT.md
@src/app/(dashboard)/facility/[facilitySlug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create clubs list page</name>
  <files>src/app/(dashboard)/facility/[facilitySlug]/clubs/page.tsx</files>
  <action>
Create the clubs list page at `src/app/(dashboard)/facility/[facilitySlug]/clubs/page.tsx`:

```tsx
import { redirect } from 'next/navigation';
import Link from 'next/link';
import { Building2, Users, Ship, ArrowLeft } from 'lucide-react';
import { getClaimsForApiRoute } from '@/lib/auth/claims';
import { prisma } from '@/lib/prisma';

interface ClubsPageProps {
  params: Promise<{ facilitySlug: string }>;
}

export default async function FacilityClubsPage({ params }: ClubsPageProps) {
  const { facilitySlug } = await params;

  // Auth checks
  const { user, facilityId, viewMode, error } = await getClaimsForApiRoute();
  if (error || !user) redirect('/login');
  if (viewMode !== 'facility') redirect('/');

  // Get facility
  const facility = await prisma.facility.findUnique({
    where: { slug: facilitySlug },
    select: { id: true, name: true },
  });
  if (!facility) redirect('/');

  // Verify FACILITY_ADMIN role
  const membership = await prisma.facilityMembership.findFirst({
    where: {
      facilityId: facility.id,
      userId: user.id,
      isActive: true,
      roles: { has: 'FACILITY_ADMIN' },
    },
  });
  if (!membership) redirect('/');

  // Get clubs with extended stats
  const clubs = await prisma.team.findMany({
    where: { facilityId: facility.id },
    select: {
      id: true,
      name: true,
      slug: true,
      primaryColor: true,
      logoUrl: true,
      createdAt: true,
      _count: {
        select: {
          members: true,
          equipment: { where: { status: 'ACTIVE' } },
          practices: true,
        },
      },
    },
    orderBy: { name: 'asc' },
  });

  return (
    <div className="max-w-6xl mx-auto">
      {/* Header */}
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-2">
          <Link
            href={`/facility/${facilitySlug}`}
            className="text-[var(--text-muted)] hover:text-[var(--text-secondary)] transition-colors"
          >
            <ArrowLeft className="h-5 w-5" />
          </Link>
          <Building2 className="h-6 w-6 text-[var(--accent)]" />
          <h1 className="text-2xl font-bold text-[var(--text-primary)]">Clubs</h1>
        </div>
        <p className="text-[var(--text-secondary)]">
          {clubs.length} club{clubs.length !== 1 ? 's' : ''} under {facility.name}
        </p>
      </div>

      {/* Club list */}
      {clubs.length === 0 ? (
        <div className="bg-[var(--surface-1)] rounded-xl p-8 text-center border border-[var(--border-subtle)]">
          <Building2 className="h-12 w-12 text-[var(--text-muted)] mx-auto mb-4" />
          <h3 className="text-lg font-medium text-[var(--text-primary)] mb-2">No clubs yet</h3>
          <p className="text-[var(--text-muted)]">
            Clubs self-register and are linked to your facility by admins.
          </p>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {clubs.map((club) => (
            <Link
              key={club.id}
              href={`/${club.slug}`}
              className="bg-[var(--surface-1)] hover:bg-[var(--surface-2)] rounded-xl p-5 border border-[var(--border-subtle)] hover:border-[var(--border)] transition-all group"
            >
              <div className="flex items-center gap-3 mb-4">
                {club.logoUrl ? (
                  <img
                    src={club.logoUrl}
                    alt={club.name}
                    className="h-12 w-12 rounded-lg object-cover"
                  />
                ) : (
                  <div
                    className="h-12 w-12 rounded-lg flex items-center justify-center text-white font-bold text-lg"
                    style={{ backgroundColor: club.primaryColor || '#059669' }}
                  >
                    {club.name.charAt(0)}
                  </div>
                )}
                <div>
                  <h3 className="font-semibold text-[var(--text-primary)] group-hover:text-[var(--accent)] transition-colors">
                    {club.name}
                  </h3>
                  <p className="text-xs text-[var(--text-muted)]">/{club.slug}</p>
                </div>
              </div>

              <div className="grid grid-cols-3 gap-2 text-sm">
                <div className="flex items-center gap-1.5 text-[var(--text-secondary)]">
                  <Users className="h-4 w-4" />
                  <span>{club._count.members}</span>
                </div>
                <div className="flex items-center gap-1.5 text-[var(--text-secondary)]">
                  <Ship className="h-4 w-4" />
                  <span>{club._count.equipment}</span>
                </div>
                <div className="text-[var(--text-muted)] text-xs">
                  Since {new Date(club.createdAt).toLocaleDateString(undefined, { month: 'short', year: '2-digit' })}
                </div>
              </div>
            </Link>
          ))}
        </div>
      )}

      {/* Info note */}
      <div className="mt-8 p-4 bg-[var(--surface-1)] rounded-lg border border-[var(--border-subtle)]">
        <p className="text-sm text-[var(--text-muted)]">
          <strong className="text-[var(--text-secondary)]">Note:</strong> As a facility admin, clicking a club gives you full admin access to manage that club&apos;s members, equipment, and schedules.
        </p>
      </div>
    </div>
  );
}
```

Key features:
- Alphabetical ordering (per CONTEXT decision)
- Shows member count, equipment count, join date
- Drill-down links to club dashboard (facility admin inherits CLUB_ADMIN)
- Empty state for facilities with no clubs yet
- Back navigation to facility dashboard
  </action>
  <verify>Navigate to /facility/{facilitySlug}/clubs - should show list of clubs with stats</verify>
  <done>Clubs page displays all clubs in alphabetical order with stats and drill-down links</done>
</task>

<task type="auto">
  <name>Task 2: Add loading skeleton for clubs page</name>
  <files>src/app/(dashboard)/facility/[facilitySlug]/clubs/loading.tsx</files>
  <action>
Create loading skeleton at `src/app/(dashboard)/facility/[facilitySlug]/clubs/loading.tsx`:

```tsx
import { Skeleton } from '@/components/ui/skeleton';

export default function ClubsLoading() {
  return (
    <div className="max-w-6xl mx-auto">
      {/* Header skeleton */}
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-2">
          <Skeleton className="h-5 w-5" />
          <Skeleton className="h-6 w-6" />
          <Skeleton className="h-8 w-24" />
        </div>
        <Skeleton className="h-5 w-48" />
      </div>

      {/* Club list skeleton */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {[1, 2, 3, 4, 5, 6].map((i) => (
          <div key={i} className="bg-[var(--surface-1)] rounded-xl p-5 border border-[var(--border-subtle)]">
            <div className="flex items-center gap-3 mb-4">
              <Skeleton className="h-12 w-12 rounded-lg" />
              <div>
                <Skeleton className="h-5 w-32 mb-1" />
                <Skeleton className="h-3 w-20" />
              </div>
            </div>
            <div className="grid grid-cols-3 gap-2">
              <Skeleton className="h-4 w-12" />
              <Skeleton className="h-4 w-12" />
              <Skeleton className="h-4 w-16" />
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```
  </action>
  <verify>Navigate to /facility/{facilitySlug}/clubs with slow connection - skeleton should display</verify>
  <done>Loading skeleton displays during page load</done>
</task>

</tasks>

<verification>
1. Build: `npm run build` passes
2. Page loads: Navigate to /facility/{facilitySlug}/clubs - shows club list
3. Alphabetical order: Clubs sorted A-Z by name
4. Stats shown: Each club displays member and equipment counts
5. Drill-down: Clicking club navigates to /{clubSlug}
6. Empty state: If no clubs, shows appropriate message
</verification>

<success_criteria>
- Clubs page accessible at /facility/{facilitySlug}/clubs
- Clubs listed in alphabetical order
- Each club card shows: logo/initial, name, slug, member count, equipment count, join date
- Clicking club navigates to club dashboard
- Loading skeleton matches layout
- Info note explains facility admin has full admin access to clubs
</success_criteria>

<output>
After completion, create `.planning/phases/17-facility-ui-features/17-03-SUMMARY.md`
</output>
