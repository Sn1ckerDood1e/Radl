---
phase: 17-facility-ui-features
plan: 11
type: execute
wave: 6
depends_on: [17-09, 17-10]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "All 6 phase requirements pass verification"
    - "Facility dashboard functions correctly"
    - "Equipment booking flow works end-to-end"
    - "Cross-club events create practices for selected clubs"
  artifacts: []
  key_links: []
---

<objective>
Verify all Phase 17 requirements are satisfied with end-to-end testing.

Purpose: Ensure all facility UI features work correctly before marking phase complete.

Output: Verification report confirming all requirements pass.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/17-facility-ui-features/17-CONTEXT.md
@.planning/milestones/v2.0-ROADMAP.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run build and type check</name>
  <files></files>
  <action>
Run full build to verify no compilation errors:

```bash
npm run build
```

This validates:
- All TypeScript types correct
- All imports resolve
- No build-time errors
- All pages compile

Also run type check separately:
```bash
npx tsc --noEmit
```
  </action>
  <verify>`npm run build` completes with no errors. `npx tsc --noEmit` passes.</verify>
  <done>Build passes with zero errors</done>
</task>

<task type="auto">
  <name>Task 2: Verify database schema</name>
  <files></files>
  <action>
Verify Prisma schema is in sync with database:

```bash
npx prisma validate
npx prisma db push --accept-data-loss=false
```

Check that EquipmentBooking table exists:
```bash
npx prisma studio
```

In Prisma Studio, verify:
- EquipmentBooking model visible with all fields
- Facility model has bookingWindowDays field
- NotificationType enum includes EQUIPMENT_REQUEST
  </action>
  <verify>Schema validates. All new models/fields exist in database.</verify>
  <done>Database schema includes all Phase 17 additions</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Phase 17 Facility UI Features:
1. Enhanced facility dashboard with card grid navigation
2. Club list page with drill-down
3. Facility equipment management (list, create)
4. Equipment booking system (request, approve/deny)
5. Cross-club event creation
6. Facility settings with booking window config
7. Club detail page with subscription overview
8. Practice form equipment booking integration
  </what-built>
  <how-to-verify>
**Start the development server:**
```bash
npm run dev
```

**FAC-09: Facility Dashboard (http://localhost:3000/facility/{facilitySlug})**
1. Navigate to facility dashboard
2. Verify stats row shows: Clubs, Total Athletes, Shared Equipment, Upcoming Events
3. Verify navigation cards: Clubs, Shared Equipment, Events, Settings
4. Verify each card links to correct sub-page
5. Verify clubs list shows below navigation cards

**FAC-05: Club List and Drill-down (/facility/{facilitySlug}/clubs)**
1. Navigate to Clubs page
2. Verify clubs sorted alphabetically
3. Verify each card shows: logo/initial, name, slug, member count, equipment count
4. Click a club card - should navigate to club dashboard
5. Click "Open Club Dashboard" - should work
6. Navigate to /facility/{facilitySlug}/clubs/{clubSlug} - verify detail page shows

**FAC-06: Shared Equipment Management (/facility/{facilitySlug}/equipment)**
1. Navigate to Shared Equipment page
2. Click "Add Equipment" - fill form with:
   - Type: Boat (Shell)
   - Name: "Test 8+"
   - Boat Class: Eight (8+)
3. Submit - should redirect to list with new equipment
4. Verify equipment shows grouped by type

**FAC-07: Equipment Booking System**
1. Create a practice for a club (as coach)
2. Expand Equipment Availability panel
3. Verify shared equipment shows "Shared" badge
4. Click "Request" on shared equipment
5. Verify dialog shows equipment name, time slot
6. Submit request
7. As facility admin, navigate to /facility/{facilitySlug}/equipment/requests
8. Verify pending request shows
9. Click "Approve" - verify status changes to APPROVED
10. Try denying another request with reason

**FAC-08: Cross-club Events (/facility/{facilitySlug}/events)**
1. Navigate to Events page
2. Click "Create Event"
3. Fill form:
   - Name: "Facility Safety Meeting"
   - Date: tomorrow
   - Time: 6:00 AM - 7:00 AM
   - Select 2+ clubs
4. Submit - should redirect to events list
5. Verify event shows with all selected clubs
6. Check each club's schedule - should have the practice

**FAC-03: Subscription Overview (/facility/{facilitySlug}/clubs/{clubSlug})**
1. Navigate to club detail page
2. Verify SubscriptionOverview component shows:
   - Plan name
   - Status (Active)
   - Usage bars (Members, Equipment, Practices)
3. If facility billing type is FACILITY, verify "covered under facility subscription" note

**Settings (/facility/{facilitySlug}/settings)**
1. Navigate to Settings
2. Change Booking Window Days to 14
3. Click Save
4. Refresh page - verify value persists
5. Change back to 30
  </how-to-verify>
  <resume-signal>Type "verified" if all checks pass, or describe any issues found</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Update project state</name>
  <files></files>
  <action>
After verification passes, update STATE.md to reflect Phase 17 completion:

1. Update Current Position section:
   - Phase: Phase 17: Facility UI Features
   - Plan: 11 of 11
   - Status: Complete
   - Last activity: [today's date]

2. Update Progress:
   ```
   v2.0: [##########] 100% â€” Phase 17 complete (34/34 requirements)
   ```

3. Add to Architecture Notes (v2.0 additions implemented in Phase 17):
   - EquipmentBooking model for reservation tracking
   - Facility dashboard with card grid navigation
   - Cross-club event creation via practice copying
   - Equipment request/approval workflow
   - Subscription overview component (mock data, ready for billing integration)

4. Update Session Continuity:
   - Stopped at: Phase 17 complete, v2.0 milestone complete
  </action>
  <verify>STATE.md reflects Phase 17 completion and v2.0 milestone completion</verify>
  <done>Project state updated to reflect completion</done>
</task>

</tasks>

<verification>
Requirements checklist:
- [ ] FAC-03: Club-level subscriptions with facility oversight - SubscriptionOverview shows billing visibility
- [ ] FAC-05: Facility admin can view all clubs - Clubs page with drill-down
- [ ] FAC-06: Facility admin can manage shared equipment - Equipment CRUD
- [ ] FAC-07: Equipment reservation/booking system - Booking API + request/approve UI
- [ ] FAC-08: Cross-club event scheduling - Events page + multi-club creation
- [ ] FAC-09: Facility dashboard with aggregate statistics - Dashboard with stats + navigation
</verification>

<success_criteria>
- All 6 Phase 17 requirements verified and working
- Build passes with no errors
- Type check passes
- Database schema in sync
- User can complete all verification steps
- STATE.md updated to reflect completion
</success_criteria>

<output>
After completion, create `.planning/phases/17-facility-ui-features/17-11-SUMMARY.md` with:
- Verification results for each requirement
- Any issues found and fixes applied
- Final v2.0 milestone status
</output>
