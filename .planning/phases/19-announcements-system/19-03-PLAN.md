---
phase: 19-announcements-system
plan: 03
type: execute
wave: 3
depends_on: ["19-02"]
files_modified:
  - src/components/announcements/announcement-priority-badge.tsx
  - src/components/announcements/announcement-card.tsx
  - src/components/announcements/announcement-list.tsx
  - src/components/announcements/announcement-banner.tsx
autonomous: true

must_haves:
  truths:
    - "Priority badge shows correct color (blue/amber/red) and icon for each level"
    - "Announcement card shows title, expands to show body, has mark-as-read button"
    - "Read announcements are visually dimmed with checkmark"
    - "Announcement list displays all announcements sorted by priority"
    - "Urgent banner is dismissible with localStorage persistence"
    - "Banner respects hydration safety (no localStorage on server)"
  artifacts:
    - path: "src/components/announcements/announcement-priority-badge.tsx"
      provides: "Color-coded badge with priority icon"
      exports: ["AnnouncementPriorityBadge"]
    - path: "src/components/announcements/announcement-card.tsx"
      provides: "Expandable card with mark-as-read"
      exports: ["AnnouncementCard"]
    - path: "src/components/announcements/announcement-list.tsx"
      provides: "Dashboard widget for announcement list"
      exports: ["AnnouncementList"]
    - path: "src/components/announcements/announcement-banner.tsx"
      provides: "Dismissible urgent banner"
      exports: ["AnnouncementBanner"]
  key_links:
    - from: "src/components/announcements/announcement-card.tsx"
      to: "/api/announcements/[id]/read"
      via: "fetch call"
      pattern: "fetch.*api/announcements.*read"
    - from: "src/components/announcements/announcement-banner.tsx"
      to: "localStorage"
      via: "dismissal persistence"
      pattern: "localStorage\\.setItem"
---

<objective>
Build the React components for displaying announcements: priority badges, expandable cards, list widget, and urgent banner.

Purpose: Provide the UI building blocks for showing announcements on dashboard and in banners. Components handle visual priority treatment, expand/collapse, mark-as-read, and dismissible banners.

Output: Four component files implementing the announcement UI patterns from research.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-announcements-system/19-CONTEXT.md
@.planning/phases/19-announcements-system/19-RESEARCH.md
@.planning/phases/19-announcements-system/19-02-SUMMARY.md

# Component patterns
@src/components/ui/button.tsx
@src/components/notifications/notification-bell.tsx
@src/components/equipment/equipment-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create priority badge and announcement card components</name>
  <files>src/components/announcements/announcement-priority-badge.tsx, src/components/announcements/announcement-card.tsx</files>
  <action>
Create src/components/announcements/announcement-priority-badge.tsx:

Use class-variance-authority (cva) for variants following button.tsx pattern.

```typescript
const badgeVariants = cva(
  "inline-flex items-center gap-1.5 rounded-md px-2 py-1 text-xs font-medium",
  {
    variants: {
      priority: {
        info: "bg-blue-500/15 text-blue-400 border border-blue-500/20",
        warning: "bg-amber-500/15 text-amber-400 border border-amber-500/20",
        urgent: "bg-red-500/15 text-red-400 border border-red-500/20",
      },
    },
  }
);
```

Icon mapping:
- INFO: Info from lucide-react
- WARNING: AlertTriangle from lucide-react
- URGENT: AlertCircle from lucide-react

Component takes priority: 'INFO' | 'WARNING' | 'URGENT' prop.
Displays icon + priority text.

---

Create src/components/announcements/announcement-card.tsx:

'use client' component (needs useState for expand, fetch for mark-as-read).

Props interface:
```typescript
interface AnnouncementCardProps {
  announcement: {
    id: string;
    title: string;
    body: string;
    priority: 'INFO' | 'WARNING' | 'URGENT';
    createdAt: string;
    practice?: { id: string; name: string; date: string } | null;
  };
  isRead: boolean;
  onMarkAsRead?: () => void;
}
```

State:
- expanded: boolean (default false)
- isRead: boolean (initialized from prop)
- isMarking: boolean (loading state)

Features:
- Click title/chevron to expand/collapse body
- ChevronDown icon rotates 180deg when expanded
- When expanded, show full body text with whitespace-pre-wrap
- "Mark as read" button (ghost variant) when not read
- When read: show Check icon, apply opacity-60 to card
- Practice link badge if announcement.practice exists

Mark as read handler:
- POST to /api/announcements/{id}/read
- On success, set isRead true
- Call onMarkAsRead callback if provided (for parent state sync)

Styling: rounded-lg border border-zinc-800 p-4, use cn() for conditional classes.
  </action>
  <verify>
Components render without errors in Storybook or test page.
TypeScript compilation passes.
Badge shows correct colors for each priority.
Card expands/collapses on click.
  </verify>
  <done>
Priority badge displays correct color and icon. Card expands to show body, mark-as-read updates visual state.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create announcement list widget component</name>
  <files>src/components/announcements/announcement-list.tsx</files>
  <action>
Create src/components/announcements/announcement-list.tsx:

'use client' component for dashboard widget.

Props interface:
```typescript
interface AnnouncementListProps {
  teamSlug: string;
  initialAnnouncements?: Array<{
    id: string;
    title: string;
    body: string;
    priority: 'INFO' | 'WARNING' | 'URGENT';
    createdAt: string;
    isRead: boolean;
    practice?: { id: string; name: string; date: string } | null;
  }>;
  showEmpty?: boolean;  // Whether to show empty state
}
```

If initialAnnouncements provided, use as starting state (SSR hydration).
Otherwise, fetch from /api/announcements on mount.

Features:
- Display list of AnnouncementCard components
- Empty state when no announcements (use EmptyState component pattern)
- "View All" link to /{teamSlug}/announcements if more than 5
- Section header: "Announcements" with Megaphone icon

Handle mark-as-read callback to update local state without refetch.

Styling:
- Section card: bg-[var(--surface-1)] rounded-xl border border-[var(--border-subtle)]
- Vertical stack of cards with gap-3
- Max height with overflow-y-auto if many announcements
  </action>
  <verify>
Component fetches and displays announcements.
Empty state shows when no announcements.
Mark as read updates card without full refetch.
  </verify>
  <done>
AnnouncementList widget displays announcements sorted by priority, handles mark-as-read updates, shows empty state when appropriate.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create dismissible urgent banner component</name>
  <files>src/components/announcements/announcement-banner.tsx</files>
  <action>
Create src/components/announcements/announcement-banner.tsx:

'use client' component (needs useState, useEffect for localStorage).

Props interface:
```typescript
interface AnnouncementBannerProps {
  announcement: {
    id: string;
    title: string;
    body: string;
    priority: 'URGENT';  // Only urgent announcements get banners
  };
}
```

CRITICAL: Hydration safety pattern:
```typescript
const [visible, setVisible] = useState(false);  // Start hidden

useEffect(() => {
  const dismissalKey = `announcement-dismissed-${announcement.id}`;
  const dismissed = localStorage.getItem(dismissalKey);
  setVisible(!dismissed);
}, [announcement.id]);
```

Do NOT read localStorage during render - only in useEffect to avoid hydration mismatch.

Dismiss handler:
- Save dismissal to localStorage with timestamp
- Set visible to false

Styling:
- Fixed at top of content area (not page-level fixed - parent controls positioning)
- Red color scheme: bg-red-500/10 border-red-500/30
- AlertCircle icon
- X button for dismiss (accessible: button element with aria-label)
- Support Escape key to dismiss (add keyboard listener)
- Animate out smoothly (use Tailwind transition-all)

Return null when not visible.

Accessibility:
- Use semantic <button> for dismiss
- aria-label="Dismiss urgent announcement"
- Focus visible on dismiss button
- role="alert" on container for screen readers
  </action>
  <verify>
Banner renders for urgent announcements.
Clicking X dismisses and persists to localStorage.
Refreshing page keeps banner dismissed.
New announcement (different id) shows banner again.
No hydration mismatch errors in console.
  </verify>
  <done>
Urgent banner is dismissible with localStorage persistence. Hydration-safe pattern prevents SSR/client mismatch. Keyboard accessible.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` — components load without errors
2. `npx tsc --noEmit` — TypeScript passes
3. Visual verification:
   - Badge: blue for INFO, amber for WARNING, red for URGENT
   - Card: expands on click, dims when read
   - List: shows sorted announcements
   - Banner: dismisses and stays dismissed across refresh
4. Console check: no hydration warnings
</verification>

<success_criteria>
- Priority badge uses CVA for type-safe color variants
- Card expand/collapse works with smooth animation
- Mark-as-read calls API and updates visual state
- Read announcements show checkmark and 60% opacity
- Banner only shows for URGENT priority
- Banner dismissal persists in localStorage
- No React hydration mismatch errors
- All components are keyboard accessible
</success_criteria>

<output>
After completion, create `.planning/phases/19-announcements-system/19-03-SUMMARY.md`
</output>
