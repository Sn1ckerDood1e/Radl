# v3.0 Architecture Research: Native App Wrappers & Branding

**Project:** Radl - Rowing Team Management
**Researched:** 2026-01-29
**Focus:** PWA-to-native integration patterns, branding architecture

---

## Executive Summary

Radl's existing PWA architecture (Next.js 16 + Serwist + Tailwind v4) is well-positioned for native wrapper integration. Two viable paths exist: **Capacitor** (recommended for full native features) and **TWA/Bubblewrap** (Android-only, simpler). The branding update requires minimal code changes due to CSS variables already being in place.

**Key finding:** The current architecture uses `output: 'export'` is NOT configured, which means Capacitor integration requires architectural decisions about SSR vs static export trade-offs.

---

## Part 1: Native App Wrapper Integration

### Current PWA Architecture

| Component | Current State | Native Compatibility |
|-----------|---------------|---------------------|
| Service Worker | Serwist with defaultCache | Works in both approaches |
| Manifest | `/public/manifest.json` | Needs icon updates only |
| Offline Support | NetworkFirst + precache | Works unchanged |
| Push Notifications | Web Push via `sw.ts` | Capacitor replaces for native |
| Install Banner | Custom `InstallBanner` component | Disable in native context |

**Existing Files:**
- `/next.config.ts` - Serwist integration, no static export
- `/src/app/sw.ts` - Service worker with push handlers
- `/src/components/pwa/pwa-wrapper.tsx` - PWA providers
- `/src/components/pwa/install-banner.tsx` - Web install prompt
- `/public/manifest.json` - PWA manifest

### Option A: Capacitor (Recommended)

**What it is:** Native runtime that wraps web apps in iOS/Android containers with access to native APIs.

**Current version:** Capacitor 8 (as of 2025)

**Key requirement:** Static export (`output: 'export'` in `next.config.ts`)

#### Critical Trade-off: SSR vs Static Export

The current Radl architecture uses React Server Components extensively:

```typescript
// Current: src/app/(dashboard)/layout.tsx uses RSC
export default async function DashboardLayout({ children }) {
  const { user, facilityId, clubId } = await getClaimsForApiRoute();
  // ... server-side data fetching
}
```

**Capacitor requires static export, which means:**
- No `getServerSideProps` or server actions in native builds
- All data fetching must use client-side API calls
- RSC benefits lost for native app

**Recommended approach: Hybrid PWA + Capacitor**

```
Web (PWA)          Native (Capacitor)
    |                    |
    v                    v
RSC + SSR          Static Export
    |                    |
    v                    v
Full Next.js       Client-only rendering
features           + API calls
```

**Implementation pattern:**

```typescript
// next.config.ts - conditional export
const nextConfig: NextConfig = {
  // Only enable static export for native builds
  ...(process.env.BUILD_TARGET === 'native' && {
    output: 'export',
    images: { unoptimized: true },
  }),
};
```

#### Capacitor Integration Points

| Integration Point | Existing Component | Required Change |
|-------------------|-------------------|-----------------|
| Platform detection | None | Add `Capacitor.isNativePlatform()` check |
| Install banner | `InstallBanner` | Hide when `isNativePlatform()` |
| Push notifications | `sw.ts` handlers | Use `@capacitor/push-notifications` |
| Status bar | None | Add `@capacitor/status-bar` |
| Splash screen | None | Add `@capacitor/splash-screen` |
| Safe areas | `globals.css` has `env()` | Already compatible |

#### Required Capacitor Packages

```bash
# Core
npm install @capacitor/core @capacitor/cli

# Platforms
npm install @capacitor/ios @capacitor/android

# Native features (replacing web equivalents)
npm install @capacitor/push-notifications
npm install @capacitor/status-bar
npm install @capacitor/splash-screen
npm install @capacitor/app
npm install @capacitor/keyboard

# Asset generation
npm install -D @capacitor/assets
```

#### New Files Required

```
/capacitor.config.ts          # Capacitor configuration
/ios/                         # iOS project (auto-generated)
/android/                     # Android project (auto-generated)
/resources/                   # Icon and splash sources
  icon.png                    # 1024x1024 app icon
  splash.png                  # 2732x2732 splash image
```

#### Build Process

```bash
# Web PWA (existing)
npm run build

# Native apps
BUILD_TARGET=native npm run build  # Static export
npx cap sync                       # Copy to native projects
npx cap open ios                   # Open Xcode
npx cap open android               # Open Android Studio
```

### Option B: Trusted Web Activity (TWA) - Android Only

**What it is:** Chrome-based wrapper that loads PWA URL in a native Android container.

**Tools:** Bubblewrap CLI or PWABuilder

**Advantages over Capacitor:**
- No code changes required
- Uses live web content (always up-to-date)
- Smaller app size
- Simpler maintenance

**Disadvantages:**
- Android only (no iOS)
- Requires Chrome 72+ on device
- Limited native API access
- Performance score must be 80+ (Lighthouse)

**When to use TWA:**
- Android-only distribution acceptable
- No additional native features needed
- Want simplest path to Play Store

#### TWA Implementation

```bash
# Install Bubblewrap
npm install -g @anthropic/bubblewrap

# Initialize
bubblewrap init --manifest https://radl.app/manifest.json

# Build APK/AAB
bubblewrap build
```

**Required files:**
- Digital Asset Links: `/.well-known/assetlinks.json`
- SHA-256 fingerprint from signing key

### Option C: PWABuilder (Multi-platform, Simplest)

**What it is:** Microsoft tool that generates native wrappers from PWA URL.

**Platforms:** Android (TWA), iOS (WebKit wrapper), Windows

**Process:**
1. Enter PWA URL at pwabuilder.com
2. Download generated packages
3. Sign and submit to stores

**Advantages:**
- Zero code changes
- Generates all platforms
- Handles store metadata

**Disadvantages:**
- Less control than Capacitor
- iOS uses WebKit, not Safari (some PWA features missing)
- No native API access beyond PWA standards

### Recommendation

**Use Capacitor** because:

1. **Full native feature access** - Push notifications work properly on iOS
2. **Single codebase** - Same React code serves web and native
3. **Store compliance** - Better App Store approval rates than WebKit wrappers
4. **Future flexibility** - Can add native modules later (camera, biometrics, etc.)

**Defer TWA** to post-launch if Android-specific optimizations needed.

---

## Part 2: Branding Architecture

### Current Theme Structure

The existing architecture already supports brand theming:

```css
/* /src/app/globals.css - Current state */
:root {
  /* Brand colors (already Radl palette) */
  --brand-primary: #0d9488;    /* Teal */
  --brand-secondary: #1f2937;  /* Charcoal */
  --brand-accent: #f59e0b;     /* Gold */

  /* Team colors (dynamic per-club) */
  --team-primary: #0d9488;
  --team-secondary: #14b8a6;
}
```

**Existing components using brand colors:**
- `InstallBanner` - hardcoded `teal-600` classes
- `Button` (shadcn) - uses `--color-primary` which maps to `--team-primary`
- Various components - mix of CSS variables and Tailwind classes

### Required Branding Changes

#### 1. PWA Manifest Updates

```json
// /public/manifest.json - needs update
{
  "name": "Radl - Crew Team Management",
  "short_name": "Radl",
  "theme_color": "#0d9488",       // Already correct
  "background_color": "#0a0a0a",  // Already correct
  "icons": [
    // Need new branded icons
  ]
}
```

#### 2. App Icon Generation

Current icons are placeholder. Need to generate from brand crest:

```
/public/icons/
  icon-192x192.png  # Shield-only version
  icon-512x512.png  # Shield-only version
  apple-touch-icon.png  # iOS home screen
  favicon.ico       # Browser tab
```

**For Capacitor native:**

```
/resources/
  icon.png          # 1024x1024 full icon
  icon-foreground.png  # Android adaptive foreground
  icon-background.png  # Android adaptive background
  splash.png        # 2732x2732 splash screen
```

#### 3. Status Bar / Theme Color Integration

**Current implementation:**

```typescript
// /src/app/layout.tsx
export const viewport: Viewport = {
  themeColor: "#0d9488",  // Already Radl teal
};
```

**For iOS PWA:**

```html
<!-- Need to add apple-specific meta tags -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
```

**For Capacitor native:**

```typescript
// Use @capacitor/status-bar
import { StatusBar, Style } from '@capacitor/status-bar';

// In app initialization
StatusBar.setBackgroundColor({ color: '#0d9488' });
StatusBar.setStyle({ style: Style.Dark });
```

#### 4. Component Theming Audit

Components with hardcoded colors that need CSS variable migration:

| Component | Current | Required Change |
|-----------|---------|-----------------|
| `InstallBanner` | `teal-600`, `teal-500` classes | Use `bg-primary` or CSS variable |
| Dashboard Header | Various | Audit for hardcoded colors |
| Loading states | Mixed | Standardize to brand colors |

**Pattern to follow:**

```typescript
// Before (hardcoded)
<div className="bg-teal-600 hover:bg-teal-700">

// After (themed)
<div className="bg-primary hover:bg-primary/90">
// or
<div className="bg-[var(--brand-primary)] hover:bg-[var(--brand-primary)]/90">
```

### Tailwind v4 Theme Integration

The project already uses Tailwind v4 with `@theme inline`:

```css
/* /src/app/globals.css - existing */
@theme inline {
  --color-primary: var(--team-primary);
  --color-primary-foreground: #ffffff;
  /* ... */
}
```

**This architecture is correct.** The brand colors flow through CSS variables and are available to both Tailwind utilities and raw CSS.

---

## Part 3: Legal Pages Integration

### Recommendation: Static Pages

Legal pages (Privacy Policy, Terms of Service) should be:

1. **Static** - No SSR needed, content changes infrequently
2. **Public** - No authentication required
3. **SEO-friendly** - Crawlable by search engines
4. **Consistent** - Same content in web and native

### Implementation Pattern

```
/src/app/(public)/
  privacy/page.tsx        # Privacy Policy
  terms/page.tsx          # Terms of Service
  layout.tsx              # Minimal header, no auth
```

**Static generation by default** in App Router - no special configuration needed.

### Content Management Options

| Approach | Complexity | Maintainability |
|----------|------------|-----------------|
| MDX files | Low | Edit requires deploy |
| CMS (Sanity, etc.) | Medium | Edit without deploy |
| Database | High | Overkill for legal pages |

**Recommendation:** MDX files for v3.0. Legal pages change infrequently, and MDX provides:
- Version control (git history)
- No external dependencies
- Works with static export for native

```typescript
// /src/app/(public)/privacy/page.tsx
import PrivacyContent from './privacy.mdx';

export default function PrivacyPage() {
  return (
    <article className="prose dark:prose-invert max-w-3xl mx-auto p-6">
      <PrivacyContent />
    </article>
  );
}
```

### Legal Page Routes in Native

For Capacitor static export, legal pages work unchanged - they're just HTML.

For deep linking from native:

```typescript
// capacitor.config.ts
{
  server: {
    // For development
    url: 'http://localhost:3000',
    cleartext: true,
  },
  // Production uses static export
}
```

---

## Part 4: Component Boundaries

### Existing Component Structure

```
/src/components/
  pwa/
    install-banner.tsx      # Web install prompt
    offline-indicator.tsx   # Offline status
    pwa-wrapper.tsx         # PWA providers
    register-sw.tsx         # SW registration
    sync-status.tsx         # Sync state
  providers/
    theme-provider.tsx      # Dark/light mode
    team-color-provider.tsx # Per-team colors (disabled)
  ui/
    button.tsx              # shadcn button
    ...
```

### New Components Needed

```
/src/components/
  native/
    platform-provider.tsx   # Platform detection context
    status-bar.tsx          # Native status bar control
    splash-screen.tsx       # Splash screen management
  pwa/
    install-banner.tsx      # UPDATE: Add native detection
```

### Platform Detection Pattern

```typescript
// /src/components/native/platform-provider.tsx
'use client';

import { createContext, useContext, useEffect, useState } from 'react';
import { Capacitor } from '@capacitor/core';

interface PlatformContext {
  isNative: boolean;
  platform: 'ios' | 'android' | 'web';
  isIOS: boolean;
  isAndroid: boolean;
}

const PlatformContext = createContext<PlatformContext>({
  isNative: false,
  platform: 'web',
  isIOS: false,
  isAndroid: false,
});

export function PlatformProvider({ children }: { children: React.ReactNode }) {
  const [platform, setPlatform] = useState<PlatformContext>({
    isNative: false,
    platform: 'web',
    isIOS: false,
    isAndroid: false,
  });

  useEffect(() => {
    const isNative = Capacitor.isNativePlatform();
    const currentPlatform = Capacitor.getPlatform() as 'ios' | 'android' | 'web';

    setPlatform({
      isNative,
      platform: currentPlatform,
      isIOS: currentPlatform === 'ios',
      isAndroid: currentPlatform === 'android',
    });
  }, []);

  return (
    <PlatformContext.Provider value={platform}>
      {children}
    </PlatformContext.Provider>
  );
}

export function usePlatform() {
  return useContext(PlatformContext);
}
```

---

## Part 5: Data Flow Changes

### Current Data Flow (Web PWA)

```
User Request
    ↓
Next.js Middleware (auth check)
    ↓
Server Component (RSC)
    ↓
Prisma Query → Supabase (via Prisma)
    ↓
Rendered HTML + RSC Payload
    ↓
Client Hydration
```

### Native Data Flow (Capacitor Static Export)

```
User Action
    ↓
Client Component
    ↓
API Route Call (fetch)
    ↓
Next.js API Route (server)
    ↓
Prisma Query → Supabase
    ↓
JSON Response
    ↓
Client State Update (React)
```

### Hybrid Approach Data Flow

For native builds, convert RSC data fetching to client-side:

```typescript
// Web version (RSC)
// /src/app/(dashboard)/[teamSlug]/page.tsx
export default async function DashboardPage() {
  const data = await prisma.team.findUnique(...);  // Server
  return <Dashboard data={data} />;
}

// Native version (client-side)
// /src/app/(dashboard)/[teamSlug]/page.tsx
'use client';
export default function DashboardPage() {
  const { data } = useSWR('/api/dashboard', fetcher);  // Client
  return <Dashboard data={data} />;
}
```

**Recommendation:** Create parallel implementations or use conditional rendering based on platform context.

---

## Part 6: Suggested Build Order

### Phase Structure Recommendation

Based on dependencies and integration points:

```
Phase 1: Branding Foundation
├── Icon generation (brand crest → app icons)
├── Manifest updates
├── Meta tag updates (theme-color, apple-web-app-*)
├── Component audit (hardcoded → CSS variable)
└── Legal page scaffolding (routes, MDX setup)

Phase 2: Legal & Compliance
├── Privacy Policy content
├── Terms of Service content
├── Footer links
└── In-app legal page navigation

Phase 3: Capacitor Setup
├── Install Capacitor packages
├── Platform detection provider
├── Conditional static export build
├── iOS/Android project initialization
└── Asset generation (@capacitor/assets)

Phase 4: Native Features
├── Status bar integration
├── Splash screen configuration
├── Push notification migration
├── Install banner native detection
└── Platform-specific polish

Phase 5: Store Preparation
├── App Store metadata
├── Play Store metadata
├── Screenshot generation
├── Beta testing (TestFlight, Internal Testing)
└── Store submission
```

### Dependency Graph

```
[Branding Foundation]
         ↓
    [Legal Pages]
         ↓
  [Capacitor Setup] ← requires branding complete for assets
         ↓
  [Native Features] ← requires Capacitor installed
         ↓
[Store Preparation] ← requires all above complete
```

---

## Confidence Assessment

| Area | Confidence | Notes |
|------|------------|-------|
| Capacitor integration | HIGH | Official docs, active ecosystem, many Next.js examples |
| Static export trade-offs | HIGH | Well-documented limitation |
| Tailwind v4 theming | HIGH | Already implemented in codebase |
| iOS status bar | MEDIUM | Limited options (default/black/black-translucent) |
| Legal page patterns | HIGH | Standard Next.js static pages |
| Store submission | MEDIUM | Depends on Apple/Google review |

---

## Sources

### Capacitor
- [Capacitor Documentation - Getting Started](https://capacitorjs.com/docs/getting-started)
- [Capacitor PWA Guide](https://capacitorjs.com/docs/web/progressive-web-apps)
- [Splash Screens and Icons](https://capacitorjs.com/docs/guides/splash-screens-and-icons)
- [GitHub: nextjs-tailwind-ionic-capacitor-starter](https://github.com/mlynch/nextjs-tailwind-ionic-capacitor-starter)

### TWA
- [Android TWA Overview](https://developer.android.com/develop/ui/views/layout/webapps/trusted-web-activities)
- [Bubblewrap CLI](https://github.com/AntipovAndrey/PWA)

### Theming
- [shadcn/ui Tailwind v4](https://ui.shadcn.com/docs/tailwind-v4)
- [shadcn/ui Theming](https://ui.shadcn.com/docs/theming)

### PWA
- [Next.js PWA Guide](https://nextjs.org/docs/app/guides/progressive-web-apps)
- [iOS Status Bar Customization](https://intercom.help/progressier/en/articles/10574799-complete-guide-to-customizing-the-mobile-status-bar-in-a-website-or-pwa)

---

## Quality Gate Checklist

- [x] Integration points clearly identified (Capacitor, manifest, theme provider, status bar)
- [x] New vs modified components explicit (new: platform-provider, status-bar; modified: install-banner, layout.tsx)
- [x] Build order considers existing dependencies (branding before Capacitor for asset generation)
- [x] Data flow changes documented (RSC vs client-side for native)
- [x] CSS variable architecture leveraged (existing globals.css structure)
